$traceurRuntime.options.symbols = true;
System.registerModule("src/leonardo/activator.drv.js", [], function() {
  "use strict";
  var __moduleName = "src/leonardo/activator.drv.js";
  function activatorDirective($compile) {
    return {
      restrict: 'A',
      link: function(scope, elem) {
        var el = angular.element('<div ng-click="activate()" class="leonardo-activator"></div>');
        var win = angular.element(['<div class="leonardo-window">', '<div class="leonardo-header">Leonardo Configuration</div>', '<window-body></window-body>', '</div>', '</div>'].join(''));
        $compile(el)(scope);
        $compile(win)(scope);
        elem.append(el);
        elem.append(win);
        win[0].addEventListener('webkitTransitionEnd', function() {
          if (!document.body.classList.contains('pull-top')) {
            document.body.classList.add("pull-top-closed");
          }
        }, false);
        scope.activate = function() {
          if (!document.body.classList.contains('pull-top')) {
            document.body.classList.add('pull-top');
            document.body.classList.remove('pull-top-closed');
          } else {
            document.body.classList.remove('pull-top');
          }
        };
      }
    };
  }
  var $__default = activatorDirective;
  return {get default() {
      return $__default;
    }};
});
$traceurRuntime.options.symbols = true;
System.registerModule("src/leonardo/configuration.srv.js", [], function() {
  "use strict";
  var __moduleName = "src/leonardo/configuration.srv.js";
  function configurationService($q, activeStatesStore, $httpBackend) {
    var states = [];
    var stateReq = {};
    var upsertOption = function(state, name, active) {
      var _states = getStatesFromStore();
      _states[$traceurRuntime.toProperty(state)] = {
        name: name,
        active: active
      };
      activeStatesStore.set('states', _states);
      return sync();
    };
    function getStatesFromStore() {
      return activeStatesStore.get('states') || {};
    }
    function fetchStates() {
      var activeStates = getStatesFromStore();
      var _states = states.map((function(state) {
        return angular.copy(state);
      }));
      _states.forEach(function(state) {
        var option = activeStates[$traceurRuntime.toProperty(state.name)];
        state.active = !!option && option.active;
        state.activeOption = !!option ? state.options.find((function(_option) {
          return _option.name === option.name;
        })) : state.options[0];
      });
      return _states;
    }
    function deactivateAll() {
      var _states = getStatesFromStore();
      Object.keys(_states).forEach(function(stateKey) {
        _states[$traceurRuntime.toProperty(stateKey)].active = false;
      });
      activeStatesStore.set('states', _states);
      return sync();
    }
    function findStateOption(name) {
      return fetchStates().find((function(state) {
        return state.name === name;
      })).activeOption;
    }
    function sync() {
      fetchStates().forEach(function(state) {
        var option = findStateOption(state.name);
        if (state.active) {
          stateReq[$traceurRuntime.toProperty(state.name)].respond(function() {
            $httpBackend.delay = option.delay;
            return [option.status, option.data];
          });
        } else {
          stateReq[$traceurRuntime.toProperty(state.name)].passThrough();
        }
      });
    }
    return {
      states: states,
      initialize: function() {
        (fetchStates() || []).forEach(function(state) {
          stateReq[$traceurRuntime.toProperty(state.name)] = $httpBackend.when(state.verb || 'GET', new RegExp(state.url));
        });
        sync();
      },
      active_states_option: [],
      upsertOption: upsertOption,
      fetchStates: fetchStates,
      getState: function(name) {
        var state = fetchStates().find((function(state) {
          return state.name === name;
        }));
        return (state && state.active && findStateOption(name)) || null;
      },
      addState: function(stateObj) {
        var $__0 = this;
        stateObj.options.forEach((function(option) {
          $__0.upsert({
            state: stateObj.name,
            url: stateObj.url,
            verb: option.verb,
            name: option.name,
            status: option.status,
            data: option.data,
            delay: option.delay
          });
        }));
      },
      addStates: function(statesArr) {
        var $__0 = this;
        statesArr.forEach((function(stateObj) {
          $__0.addState(stateObj);
        }));
      },
      upsert: function($__1) {
        var $__3,
            $__4,
            $__5;
        var $__2 = $__1,
            verb = $__2.verb,
            state = $__2.state,
            name = $__2.name,
            url = $__2.url,
            status = ($__3 = $__2.status) === void 0 ? 200 : $__3,
            data = ($__4 = $__2.data) === void 0 ? {} : $__4,
            delay = ($__5 = $__2.delay) === void 0 ? 0 : $__5;
        var defaultState = {};
        var defaultOption = {};
        if (!state) {
          console.log("cannot upsert - state is mandatory");
          return ;
        }
        var stateItem = states.find((function(_state) {
          return _state.name === state;
        })) || defaultState;
        angular.extend(stateItem, {
          name: state,
          url: url || stateItem.url,
          verb: verb || stateItem.verb,
          options: stateItem.options || []
        });
        if (stateItem === defaultState) {
          states.push(stateItem);
        }
        var option = stateItem.options.find((function(_option) {
          return _option.name === name;
        })) || defaultOption;
        angular.extend(option, {
          name: name,
          status: status,
          data: data,
          delay: delay
        });
        if (option === defaultOption) {
          stateItem.options.push(option);
        }
      },
      upsertMany: function(items) {
        var $__0 = this;
        items.forEach((function(item) {
          return $__0.upsert(item);
        }));
      },
      deactivateAll: deactivateAll
    };
  }
  var $__default = configurationService;
  return {get default() {
      return $__default;
    }};
});
$traceurRuntime.options.symbols = true;
System.registerModule("src/leonardo/window-body.drv.js", [], function() {
  "use strict";
  var __moduleName = "src/leonardo/window-body.drv.js";
  function windowBodyDirective($http, configuration) {
    return {
      restrict: 'E',
      templateUrl: 'window-body.html',
      scope: true,
      replace: true,
      controller: function($scope) {
        $scope.selectedItem = 'activate';
        $scope.NothasUrl = function(option) {
          return !option.url;
        };
        $scope.hasUrl = function(option) {
          return !!option.url;
        };
        $scope.deactivate = function() {
          $scope.states.forEach(function(state) {
            state.active = false;
          });
          configuration.deactivateAll();
        };
        $scope.updateState = function(state) {
          console.log(("update state: " + state.name + " " + state.activeOption.name + " " + state.active));
          configuration.upsertOption(state.name, state.activeOption.name, state.active);
        };
        $scope.states = configuration.fetchStates();
      },
      link: function(scope) {
        scope.test = {
          url: '',
          value: undefined
        };
        scope.submit = function(url) {
          scope.test.value = undefined;
          scope.url = url;
          if (url) {
            $http.get(url).success(function(res) {
              scope.test.value = res;
            });
          }
        };
      }
    };
  }
  var $__default = windowBodyDirective;
  return {get default() {
      return $__default;
    }};
});
$traceurRuntime.options.symbols = true;
System.registerModule("src/leonardo/module.js", [], function() {
  "use strict";
  var __moduleName = "src/leonardo/module.js";
  var activatorDirective = System.get("src/leonardo/activator.drv.js").default;
  var configurationService = System.get("src/leonardo/configuration.srv.js").default;
  var windowBodyDirective = System.get("src/leonardo/window-body.drv.js").default;
  var $__default = angular.module('leonardo', ['leonardo.templates', 'angular-storage', 'ngMockE2E']).factory('configuration', configurationService).factory('activeStatesStore', function(store) {
    return store.getNamespacedStore('active_states');
  }).directive('activator', activatorDirective).directive('windowBody', windowBodyDirective).config(function($provide) {
    $provide.decorator('$httpBackend', function($delegate) {
      var proxy = function(method, url, data, callback, headers) {
        var interceptor = function() {
          var _this = this,
              _arguments = arguments;
          setTimeout(function() {
            callback.apply(_this, _arguments);
          }, proxy.delay || 0);
          proxy.delay = 0;
        };
        return $delegate.call(this, method, url, data, interceptor, headers);
      };
      for (var key in $delegate)
        if (!$traceurRuntime.isSymbolString(key)) {
          proxy[$traceurRuntime.toProperty(key)] = $delegate[$traceurRuntime.toProperty(key)];
        }
      proxy.setDelay = (function(delay) {
        proxy.delay = delay;
      });
      return proxy;
    });
  });
  return {get default() {
      return $__default;
    }};
});
System.get("src/leonardo/module.js" + '');
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9sZW9uYXJkby9hY3RpdmF0b3IuZHJ2LmpzIiwic3JjL2xlb25hcmRvL2NvbmZpZ3VyYXRpb24uc3J2LmpzIiwic3JjL2xlb25hcmRvL3dpbmRvdy1ib2R5LmRydi5qcyIsInNyYy9sZW9uYXJkby9tb2R1bGUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkEsYyxRLFEsRSxLLEM7QSxLLGUsQSxpQyxHLEMsVSxBOztBLEEsSSxDLFksa0MsQztBQUFBLFNBQVMsbUJBQWlCLENBQUUsUUFBTztBQUNqQyxTQUFPO0FBQ0wsYUFBTyxDQUFHLElBQUU7QUFDWixTQUFHLENBQUcsVUFBUyxLQUFJLENBQUcsQ0FBQSxJQUFHO0FBQ3ZCLEFBQUksVUFBQSxDQUFBLEVBQUMsRUFBSSxDQUFBLE9BQU0sUUFBUSxBQUFDLENBQUMsOERBQTZELENBQUMsQ0FBQztBQUV4RixBQUFJLFVBQUEsQ0FBQSxHQUFFLEVBQUksQ0FBQSxPQUFNLFFBQVEsQUFBQyxDQUFDLENBQzFCLCtCQUE4QixDQUM1Qiw0REFBMEQsQ0FDeEQsOEJBQTRCLENBQzlCLFNBQU8sQ0FDVCxTQUFPLENBQ1AsS0FBSyxBQUFDLENBQUMsRUFBQyxDQUFDLENBQUMsQ0FBQztBQUVYLGVBQU8sQUFBQyxDQUFDLEVBQUMsQ0FBQyxBQUFDLENBQUMsS0FBSSxDQUFDLENBQUM7QUFDbkIsZUFBTyxBQUFDLENBQUMsR0FBRSxDQUFDLEFBQUMsQ0FBQyxLQUFJLENBQUMsQ0FBQztBQUVwQixXQUFHLE9BQU8sQUFBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO0FBQ2YsV0FBRyxPQUFPLEFBQUMsQ0FBQyxHQUFFLENBQUMsQ0FBQztBQUVoQixVQUFFLENBQUUsQ0FBQSxDQUFDLGlCQUFpQixBQUFDLENBQUUscUJBQW9CLENBQUcsVUFBUyxBQUFELENBQUc7QUFDekQsYUFBSSxDQUFDLFFBQU8sS0FBSyxVQUFVLFNBQVMsQUFBQyxDQUFDLFVBQVMsQ0FBQyxDQUFFO0FBQ2hELG1CQUFPLEtBQUssVUFBVSxJQUFJLEFBQUMsQ0FBQyxpQkFBZ0IsQ0FBQyxDQUFDO1VBQ2hEO0FBQUEsUUFDRixDQUFHLE1BQUksQ0FBRSxDQUFDO0FBRVYsWUFBSSxTQUFTLEVBQUksVUFBUyxBQUFELENBQUU7QUFDekIsYUFBSSxDQUFDLFFBQU8sS0FBSyxVQUFVLFNBQVMsQUFBQyxDQUFDLFVBQVMsQ0FBQyxDQUFHO0FBQ2pELG1CQUFPLEtBQUssVUFBVSxJQUFJLEFBQUMsQ0FBQyxVQUFTLENBQUMsQ0FBQztBQUN2QyxtQkFBTyxLQUFLLFVBQVUsT0FBTyxBQUFDLENBQUMsaUJBQWdCLENBQUMsQ0FBQztVQUNuRCxLQUNLO0FBQ0gsbUJBQU8sS0FBSyxVQUFVLE9BQU8sQUFBQyxDQUFDLFVBQVMsQ0FBQyxDQUFDO1VBQzVDO0FBQUEsUUFDRixDQUFDO01BQ0g7QUFBQSxJQUNGLENBQUM7RUFDSDtBQXJDQSxBQUFJLElBQUEsQ0FBQSxVQUFTLEVBdUNFLG1CQUFpQixBQXZDQyxDQUFBO0FBQWpDLFNBQUEsYUFBd0I7QUFBRSx1QkFBd0I7SUFBRSxFQUE3QjtBQUVqQixDQUZ3RCxDQUFDO0FBQS9ELGNBQWMsUUFBUSxRQUFRLEVBQUksS0FBRyxDQUFBO0FBQXJDLEtBQUssZUFBZSxBQUFDLHFDQUFvQixHQUFDLENBQTFDLFVBQVMsQUFBRDs7QUFBUixBQUFJLElBQUEsQ0FBQSxZQUFXLHNDQUFvQixDQUFDO0FDQXBDLFNBQVMscUJBQW1CLENBQUUsRUFBQyxDQUFHLENBQUEsaUJBQWdCLENBQUcsQ0FBQSxZQUFXO0FBQzlELEFBQUksTUFBQSxDQUFBLE1BQUssRUFBSSxHQUFDLENBQUM7QUFDZixBQUFJLE1BQUEsQ0FBQSxRQUFPLEVBQUksR0FBQyxDQUFDO0FBRWpCLEFBQUksTUFBQSxDQUFBLFlBQVcsRUFBSSxVQUFTLEtBQUksQ0FBRyxDQUFBLElBQUcsQ0FBRyxDQUFBLE1BQUs7QUFDNUMsQUFBSSxRQUFBLENBQUEsT0FBTSxFQUFJLENBQUEsa0JBQWlCLEFBQUMsRUFBQyxDQUFDO0FBQ2xDLFlBQU0sQ0FOUSxlQUFjLFdBQVcsQUFBQyxDQU1oQyxLQUFJLENBTjhDLENBQUMsRUFNMUM7QUFDZixXQUFHLENBQUcsS0FBRztBQUNULGFBQUssQ0FBRyxPQUFLO0FBQUEsTUFDZixDQUFDO0FBRUQsc0JBQWdCLElBQUksQUFBQyxDQUFDLFFBQU8sQ0FBRyxRQUFNLENBQUMsQ0FBQztBQUV4QyxXQUFPLENBQUEsSUFBRyxBQUFDLEVBQUMsQ0FBQztJQUNmLENBQUM7QUFFRCxXQUFTLG1CQUFpQixDQUFFLEFBQUQsQ0FBRTtBQUMzQixXQUFPLENBQUEsaUJBQWdCLElBQUksQUFBQyxDQUFDLFFBQU8sQ0FBQyxDQUFBLEVBQUssR0FBQyxDQUFDO0lBQzlDO0FBQUEsQUFFQSxXQUFTLFlBQVUsQ0FBRSxBQUFEO0FBQ2xCLEFBQUksUUFBQSxDQUFBLFlBQVcsRUFBSSxDQUFBLGtCQUFpQixBQUFDLEVBQUMsQ0FBQztBQUN2QyxBQUFJLFFBQUEsQ0FBQSxPQUFNLEVBQUksQ0FBQSxNQUFLLElBQUksQUFBQyxFQUFDLFNBQUEsS0FBSTthQUFLLENBQUEsT0FBTSxLQUFLLEFBQUMsQ0FBQyxLQUFJLENBQUM7TUFBQSxFQUFDLENBQUM7QUFFdEQsWUFBTSxRQUFRLEFBQUMsQ0FBQyxTQUFTLEtBQUk7QUFDM0IsQUFBSSxVQUFBLENBQUEsTUFBSyxFQXpCZixDQXlCbUIsWUFBVyxDQXpCWixlQUFjLFdBQVcsQUFBQyxDQXlCWixLQUFJLEtBQUssQ0F6QnFCLENBQUMsQUF5QnJCLENBQUM7QUFDckMsWUFBSSxPQUFPLEVBQUksQ0FBQSxDQUFDLENBQUMsTUFBSyxDQUFBLEVBQUssQ0FBQSxNQUFLLE9BQU8sQ0FBQztBQUN4QyxZQUFJLGFBQWEsRUFBSSxDQUFBLENBQUMsQ0FBQyxNQUFLLENBQUEsQ0FBSSxDQUFBLEtBQUksUUFBUSxLQUFLLEFBQUMsRUFBQyxTQUFBLE9BQU07ZUFBSyxDQUFBLE9BQU0sS0FBSyxJQUFNLENBQUEsTUFBSyxLQUFLO1FBQUEsRUFBQyxDQUFBLENBQUksQ0FBQSxLQUFJLFFBQVEsQ0FBRSxDQUFBLENBQUMsQ0FBQztNQUNoSCxDQUFDLENBQUM7QUFFRixXQUFPLFFBQU0sQ0FBQztJQUNoQjtBQUVBLFdBQVMsY0FBWSxDQUFFLEFBQUQ7QUFDcEIsQUFBSSxRQUFBLENBQUEsT0FBTSxFQUFJLENBQUEsa0JBQWlCLEFBQUMsRUFBQyxDQUFDO0FBQ2xDLFdBQUssS0FBSyxBQUFDLENBQUMsT0FBTSxDQUFDLFFBQVEsQUFBQyxDQUFDLFNBQVMsUUFBTztBQUMzQyxjQUFNLENBcENNLGVBQWMsV0FBVyxBQUFDLENBb0M5QixRQUFPLENBcEN5QyxDQUFDLE9Bb0NsQyxFQUFJLE1BQUksQ0FBQztNQUNsQyxDQUFDLENBQUM7QUFDRixzQkFBZ0IsSUFBSSxBQUFDLENBQUMsUUFBTyxDQUFHLFFBQU0sQ0FBQyxDQUFDO0FBRXhDLFdBQU8sQ0FBQSxJQUFHLEFBQUMsRUFBQyxDQUFDO0lBQ2Y7QUFFQSxXQUFTLGdCQUFjLENBQUUsSUFBRztBQUMxQixXQUFPLENBQUEsV0FBVSxBQUFDLEVBQUMsS0FBSyxBQUFDLEVBQUMsU0FBQSxLQUFJO2FBQUssQ0FBQSxLQUFJLEtBQUssSUFBTSxLQUFHO01BQUEsRUFBQyxhQUFhLENBQUM7SUFDdEU7QUFFQSxXQUFTLEtBQUcsQ0FBRSxBQUFEO0FBQ1gsZ0JBQVUsQUFBQyxFQUFDLFFBQVEsQUFBQyxDQUFDLFNBQVUsS0FBSTtBQUNsQyxBQUFJLFVBQUEsQ0FBQSxNQUFLLEVBQUksQ0FBQSxlQUFjLEFBQUMsQ0FBQyxLQUFJLEtBQUssQ0FBQyxDQUFDO0FBQ3hDLFdBQUksS0FBSSxPQUFPLENBQUc7QUFDaEIsaUJBQU8sQ0FuREcsZUFBYyxXQUFXLEFBQUMsQ0FtRDNCLEtBQUksS0FBSyxDQW5Eb0MsQ0FBQyxRQW1ENUIsQUFBQyxDQUFDLFNBQVUsQUFBRCxDQUFHO0FBQ3ZDLHVCQUFXLE1BQU0sRUFBSSxDQUFBLE1BQUssTUFBTSxDQUFDO0FBQ2pDLGlCQUFPLEVBQUMsTUFBSyxPQUFPLENBQUcsQ0FBQSxNQUFLLEtBQUssQ0FBQyxDQUFDO1VBQ3JDLENBQUMsQ0FBQztRQUNKLEtBQ0s7QUFDSCxpQkFBTyxDQXpERyxlQUFjLFdBQVcsQUFBQyxDQXlEM0IsS0FBSSxLQUFLLENBekRvQyxDQUFDLFlBeUR4QixBQUFDLEVBQUMsQ0FBQztRQUNwQztBQUFBLE1BQ0YsQ0FBQyxDQUFDO0lBQ0o7QUFFQSxTQUFPO0FBRUwsV0FBSyxDQUFHLE9BQUs7QUFDYixlQUFTLENBQUcsVUFBUyxBQUFEO0FBQ2xCLFFBQUMsV0FBVSxBQUFDLEVBQUMsQ0FBQSxFQUFLLEdBQUMsQ0FBQyxRQUFRLEFBQUMsQ0FBQyxTQUFVLEtBQUk7QUFDMUMsaUJBQU8sQ0FuRUcsZUFBYyxXQUFXLEFBQUMsQ0FtRTNCLEtBQUksS0FBSyxDQW5Fb0MsQ0FBQyxFQW1FaEMsQ0FBQSxZQUFXLEtBQUssQUFBQyxDQUFDLEtBQUksS0FBSyxHQUFLLE1BQUksQ0FBRyxJQUFJLE9BQUssQUFBQyxDQUFDLEtBQUksSUFBSSxDQUFDLENBQUMsQ0FBQztRQUN0RixDQUFDLENBQUM7QUFFRixXQUFHLEFBQUMsRUFBQyxDQUFDO01BQ1I7QUFFQSx5QkFBbUIsQ0FBRyxHQUFDO0FBRXZCLGlCQUFXLENBQUcsYUFBVztBQUV6QixnQkFBVSxDQUFHLFlBQVU7QUFDdkIsYUFBTyxDQUFHLFVBQVMsSUFBRztBQUNwQixBQUFJLFVBQUEsQ0FBQSxLQUFJLEVBQUksQ0FBQSxXQUFVLEFBQUMsRUFBQyxLQUFLLEFBQUMsRUFBQyxTQUFBLEtBQUk7ZUFBSyxDQUFBLEtBQUksS0FBSyxJQUFNLEtBQUc7UUFBQSxFQUFDLENBQUM7QUFDNUQsYUFBTyxDQUFBLENBQUMsS0FBSSxHQUFLLENBQUEsS0FBSSxPQUFPLENBQUEsRUFBSyxDQUFBLGVBQWMsQUFBQyxDQUFDLElBQUcsQ0FBQyxDQUFDLEdBQUssS0FBRyxDQUFDO01BQ2pFO0FBQ0EsYUFBTyxDQUFHLFVBQVMsUUFBTzs7QUFDeEIsZUFBTyxRQUFRLFFBQVEsQUFBQyxFQUFDLFNBQUMsTUFBSyxDQUFNO0FBQ25DLG9CQUFVLEFBQUMsQ0FBQztBQUNWLGdCQUFJLENBQUcsQ0FBQSxRQUFPLEtBQUs7QUFDbkIsY0FBRSxDQUFHLENBQUEsUUFBTyxJQUFJO0FBQ2hCLGVBQUcsQ0FBRyxDQUFBLE1BQUssS0FBSztBQUNoQixlQUFHLENBQUcsQ0FBQSxNQUFLLEtBQUs7QUFDaEIsaUJBQUssQ0FBRyxDQUFBLE1BQUssT0FBTztBQUNwQixlQUFHLENBQUcsQ0FBQSxNQUFLLEtBQUs7QUFDaEIsZ0JBQUksQ0FBRyxDQUFBLE1BQUssTUFBTTtBQUFBLFVBQ3BCLENBQUMsQ0FBQztRQUNKLEVBQUMsQ0FBQztNQUNKO0FBQ0EsY0FBUSxDQUFHLFVBQVMsU0FBUTs7QUFDMUIsZ0JBQVEsUUFBUSxBQUFDLEVBQUMsU0FBQyxRQUFPLENBQU07QUFDOUIsc0JBQVksQUFBQyxDQUFDLFFBQU8sQ0FBQyxDQUFDO1FBQ3pCLEVBQUMsQ0FBQztNQUNKO0FBRUEsV0FBSyxDQUFHLFVBQVMsSUFBNEQ7Ozs7O0FBQTFELGVBQUc7QUFBRyxnQkFBSTtBQUFHLGVBQUc7QUFBRyxjQUFFO0FBQUcsaUJBQUssRUFyR3BELENBQUEsQ0FBQyxrQkFBc0QsQ0FBQyxJQUFNLEtBQUssRUFBQSxDQUFBLENBcUdYLElBQUUsT0FwR2Q7QUFvR2lCLGVBQUcsRUFyR2hFLENBQUEsQ0FBQyxnQkFBc0QsQ0FBQyxJQUFNLEtBQUssRUFBQSxDQUFBLENBcUdDLEdBQUMsT0FwR3pCO0FBb0c0QixnQkFBSSxFQXJHNUUsQ0FBQSxDQUFDLGlCQUFzRCxDQUFDLElBQU0sS0FBSyxFQUFBLENBQUEsQ0FxR2EsRUFBQSxPQXBHcEM7QUFxR3RDLEFBQUksVUFBQSxDQUFBLFlBQVcsRUFBSSxHQUFDLENBQUM7QUFFckIsQUFBSSxVQUFBLENBQUEsYUFBWSxFQUFJLEdBQUMsQ0FBQztBQUV0QixXQUFJLENBQUMsS0FBSSxDQUFHO0FBQ1YsZ0JBQU0sSUFBSSxBQUFDLENBQUMsb0NBQW1DLENBQUMsQ0FBQztBQUNqRCxpQkFBTTtRQUNSO0FBQUEsQUFFSSxVQUFBLENBQUEsU0FBUSxFQUFJLENBQUEsTUFBSyxLQUFLLEFBQUMsRUFBQyxTQUFBLE1BQUs7ZUFBSyxDQUFBLE1BQUssS0FBSyxJQUFNLE1BQUk7UUFBQSxFQUFDLENBQUEsRUFBSyxhQUFXLENBQUM7QUFFNUUsY0FBTSxPQUFPLEFBQUMsQ0FBQyxTQUFRLENBQUc7QUFDeEIsYUFBRyxDQUFHLE1BQUk7QUFDVixZQUFFLENBQUcsQ0FBQSxHQUFFLEdBQUssQ0FBQSxTQUFRLElBQUk7QUFDeEIsYUFBRyxDQUFHLENBQUEsSUFBRyxHQUFLLENBQUEsU0FBUSxLQUFLO0FBQzNCLGdCQUFNLENBQUcsQ0FBQSxTQUFRLFFBQVEsR0FBSyxHQUFDO0FBQUEsUUFDakMsQ0FBQyxDQUFDO0FBR0YsV0FBSSxTQUFRLElBQU0sYUFBVyxDQUFHO0FBQzlCLGVBQUssS0FBSyxBQUFDLENBQUMsU0FBUSxDQUFDLENBQUM7UUFDeEI7QUFBQSxBQUVJLFVBQUEsQ0FBQSxNQUFLLEVBQUksQ0FBQSxTQUFRLFFBQVEsS0FBSyxBQUFDLEVBQUMsU0FBQSxPQUFNO2VBQUssQ0FBQSxPQUFNLEtBQUssSUFBTSxLQUFHO1FBQUEsRUFBQyxDQUFBLEVBQUssY0FBWSxDQUFDO0FBRXRGLGNBQU0sT0FBTyxBQUFDLENBQUMsTUFBSyxDQUFHO0FBQ3JCLGFBQUcsQ0FBRyxLQUFHO0FBQ1QsZUFBSyxDQUFHLE9BQUs7QUFDYixhQUFHLENBQUcsS0FBRztBQUNULGNBQUksQ0FBRyxNQUFJO0FBQUEsUUFDYixDQUFDLENBQUM7QUFFRixXQUFJLE1BQUssSUFBTSxjQUFZLENBQUc7QUFDNUIsa0JBQVEsUUFBUSxLQUFLLEFBQUMsQ0FBQyxNQUFLLENBQUMsQ0FBQztRQUNoQztBQUFBLE1BQ0Y7QUFFQSxlQUFTLENBQUcsVUFBUyxLQUFJOztBQUN2QixZQUFJLFFBQVEsQUFBQyxFQUFDLFNBQUEsSUFBRztlQUFLLENBQUEsV0FBVSxBQUFDLENBQUMsSUFBRyxDQUFDO1FBQUEsRUFBQyxDQUFDO01BQzFDO0FBQ0Esa0JBQVksQ0FBRyxjQUFZO0FBQUEsSUFDN0IsQ0FBQztFQUNIO0FBaEpBLEFBQUksSUFBQSxDQUFBLFVBQVMsRUFrSkUscUJBQW1CLEFBbEpELENBQUE7QUFBakMsU0FBQSxhQUF3QjtBQUFFLHVCQUF3QjtJQUFFLEVBQTdCO0FBRWpCLENBRndELENBQUM7QUFBL0QsY0FBYyxRQUFRLFFBQVEsRUFBSSxLQUFHLENBQUE7QUFBckMsS0FBSyxlQUFlLEFBQUMsbUNBQW9CLEdBQUMsQ0FBMUMsVUFBUyxBQUFEOztBQUFSLEFBQUksSUFBQSxDQUFBLFlBQVcsb0NBQW9CLENBQUM7QUNXcEMsU0FBUyxvQkFBa0IsQ0FBRSxLQUFJLENBQUcsQ0FBQSxhQUFZLENBQUc7QUFDakQsU0FBTztBQUNMLGFBQU8sQ0FBRyxJQUFFO0FBQ1osZ0JBQVUsQ0FBRyxtQkFBaUI7QUFDOUIsVUFBSSxDQUFHLEtBQUc7QUFDVixZQUFNLENBQUcsS0FBRztBQUNaLGVBQVMsQ0FBRyxVQUFTLE1BQUssQ0FBRTtBQUMxQixhQUFLLGFBQWEsRUFBSSxXQUFTLENBQUM7QUFDaEMsYUFBSyxVQUFVLEVBQUksVUFBUyxNQUFLLENBQUU7QUFDakMsZUFBTyxFQUFDLE1BQUssSUFBSSxDQUFDO1FBQ3BCLENBQUM7QUFDRCxhQUFLLE9BQU8sRUFBSSxVQUFTLE1BQUssQ0FBRTtBQUM5QixlQUFPLEVBQUMsQ0FBQyxNQUFLLElBQUksQ0FBQztRQUNyQixDQUFDO0FBRUQsYUFBSyxXQUFXLEVBQUksVUFBUyxBQUFELENBQUc7QUFDN0IsZUFBSyxPQUFPLFFBQVEsQUFBQyxDQUFDLFNBQVMsS0FBSSxDQUFFO0FBQ2pDLGdCQUFJLE9BQU8sRUFBSSxNQUFJLENBQUM7VUFDeEIsQ0FBQyxDQUFDO0FBQ0Ysc0JBQVksY0FBYyxBQUFDLEVBQUMsQ0FBQztRQUMvQixDQUFDO0FBRUQsYUFBSyxZQUFZLEVBQUksVUFBUyxLQUFJLENBQUU7QUFDbEMsZ0JBQU0sSUFBSSxBQUFDLEVBQUMsZ0JBQWdCLEVBQUMsQ0FBQSxLQUFJLEtBQUssRUFBQyxJQUFHLEVBQUMsQ0FBQSxLQUFJLGFBQWEsS0FBSyxFQUFDLElBQUcsRUFBQyxDQUFBLEtBQUksT0FBTyxFQUFHLENBQUM7QUFDckYsc0JBQVksYUFBYSxBQUFDLENBQUMsS0FBSSxLQUFLLENBQUcsQ0FBQSxLQUFJLGFBQWEsS0FBSyxDQUFHLENBQUEsS0FBSSxPQUFPLENBQUMsQ0FBQztRQUMvRSxDQUFDO0FBRUQsYUFBSyxPQUFPLEVBQUksQ0FBQSxhQUFZLFlBQVksQUFBQyxFQUFDLENBQUM7TUFDN0M7QUFDQSxTQUFHLENBQUcsVUFBUyxLQUFJLENBQUc7QUFDcEIsWUFBSSxLQUFLLEVBQUk7QUFDWCxZQUFFLENBQUcsR0FBQztBQUNOLGNBQUksQ0FBRyxVQUFRO0FBQUEsUUFDakIsQ0FBQztBQUVELFlBQUksT0FBTyxFQUFJLFVBQVMsR0FBRSxDQUFFO0FBQzFCLGNBQUksS0FBSyxNQUFNLEVBQUksVUFBUSxDQUFDO0FBQzVCLGNBQUksSUFBSSxFQUFJLElBQUUsQ0FBQztBQUNmLGFBQUksR0FBRSxDQUFHO0FBQ1AsZ0JBQUksSUFBSSxBQUFDLENBQUMsR0FBRSxDQUFDLFFBQVEsQUFBQyxDQUFDLFNBQVUsR0FBRSxDQUFHO0FBQ3BDLGtCQUFJLEtBQUssTUFBTSxFQUFJLElBQUUsQ0FBQztZQUN4QixDQUFDLENBQUM7VUFDSjtBQUFBLFFBQ0YsQ0FBQztNQUNIO0FBQUEsSUFDRixDQUFDO0VBQ0g7QUFBQSxBQXpESSxJQUFBLENBQUEsVUFBUyxFQTJERSxvQkFBa0IsQUEzREEsQ0FBQTtBQUFqQyxTQUFBLGFBQXdCO0FBQUUsdUJBQXdCO0lBQUUsRUFBN0I7QUFFakIsQ0FGd0QsQ0FBQztBQUEvRCxjQUFjLFFBQVEsUUFBUSxFQUFJLEtBQUcsQ0FBQTtBQUFyQyxLQUFLLGVBQWUsQUFBQywwQkFBb0IsR0FBQyxDQUExQyxVQUFTLEFBQUQ7O0FBQVIsQUFBSSxJQUFBLENBQUEsWUFBVywyQkFBb0IsQ0FBQztJQ0E3QixtQkFBaUIsRUFBeEIsQ0FBQSxNQUFLLElBQUksQUFBQyxpQ0FBa0I7SUFDckIscUJBQW1CLEVBRDFCLENBQUEsTUFBSyxJQUFJLEFBQUMscUNBQWtCO0lBRXJCLG9CQUFrQixFQUZ6QixDQUFBLE1BQUssSUFBSSxBQUFDLG1DQUFrQjtBQUE1QixBQUFJLElBQUEsQ0FBQSxVQUFTLEVBSUUsQ0FBQSxPQUFNLE9BQU8sQUFBQyxDQUFDLFVBQVMsQ0FBRyxFQUFDLG9CQUFtQixDQUFHLGtCQUFnQixDQUFHLFlBQVUsQ0FBQyxDQUFDLFFBQ3ZGLEFBQUMsQ0FBQyxlQUFjLENBQUcscUJBQW1CLENBQUMsUUFDdkMsQUFBQyxDQUFDLG1CQUFrQixDQUFHLFVBQVMsS0FBSSxDQUFHO0FBQzVDLFNBQU8sQ0FBQSxLQUFJLG1CQUFtQixBQUFDLENBQUMsZUFBYyxDQUFDLENBQUM7RUFDbEQsQ0FBQyxVQUNRLEFBQUMsQ0FBQyxXQUFVLENBQUcsbUJBQWlCLENBQUMsVUFDakMsQUFBQyxDQUFDLFlBQVcsQ0FBRyxvQkFBa0IsQ0FBQyxPQUt0QyxBQUFDLENBQUMsU0FBUyxRQUFPO0FBQ3RCLFdBQU8sVUFBVSxBQUFDLENBQUMsY0FBYSxDQUFHLFVBQVMsU0FBUTtBQUNsRCxBQUFJLFFBQUEsQ0FBQSxLQUFJLEVBQUksVUFBUyxNQUFLLENBQUcsQ0FBQSxHQUFFLENBQUcsQ0FBQSxJQUFHLENBQUcsQ0FBQSxRQUFPLENBQUcsQ0FBQSxPQUFNLENBQUc7QUFDekQsQUFBSSxVQUFBLENBQUEsV0FBVSxFQUFJLFVBQVMsQUFBRCxDQUFHO0FBQzNCLEFBQUksWUFBQSxDQUFBLEtBQUksRUFBSSxLQUFHO0FBQ1gsdUJBQVMsRUFBSSxVQUFRLENBQUM7QUFDMUIsbUJBQVMsQUFBQyxDQUFDLFNBQVMsQUFBRCxDQUFHO0FBQ3BCLG1CQUFPLE1BQU0sQUFBQyxDQUFDLEtBQUksQ0FBRyxXQUFTLENBQUMsQ0FBQztVQUNuQyxDQUFHLENBQUEsS0FBSSxNQUFNLEdBQUssRUFBQSxDQUFDLENBQUM7QUFDcEIsY0FBSSxNQUFNLEVBQUksRUFBQSxDQUFDO1FBQ2pCLENBQUM7QUFDRCxhQUFPLENBQUEsU0FBUSxLQUFLLEFBQUMsQ0FBQyxJQUFHLENBQUcsT0FBSyxDQUFHLElBQUUsQ0FBRyxLQUFHLENBQUcsWUFBVSxDQUFHLFFBQU0sQ0FBQyxDQUFDO01BQ3RFLENBQUM7QUFDRCxVQUFRLEdBQUEsQ0FBQSxHQUFFLENBQUEsRUFBSyxVQUFRO0FBNUI3QixXQUFJLENBQUMsZUFBYyxlQUFlLEFBQUMsS0FBa0IsQ0E0QnJCO0FBQ3hCLGNBQUksQ0E3Qk0sZUFBYyxXQUFXLEFBQUMsQ0E2QjlCLEdBQUUsQ0E3QjhDLENBQUMsRUFBL0QsQ0E2QnFCLFNBQVEsQ0E3QlgsZUFBYyxXQUFXLEFBQUMsQ0E2QmIsR0FBRSxDQTdCNkIsQ0FBQyxBQTZCN0IsQ0FBQztRQUM3QjtBQTlCa0UsQUErQmxFLFVBQUksU0FBUyxJQUFJLFNBQUMsS0FBSSxDQUFNO0FBQzFCLFlBQUksTUFBTSxFQUFJLE1BQUksQ0FBQztNQUNyQixDQUFBLENBQUM7QUFDRCxXQUFPLE1BQUksQ0FBQztJQUNkLENBQUMsQ0FBQztFQUNKLENBQUMsQUFwQzhCLENBQUE7QUFBakMsU0FBQSxhQUF3QjtBQUFFLHVCQUF3QjtJQUFFLEVBQTdCO0FBRWpCLENBRndELENBQUM7QUFBL0QsS0FBSyxJQUFJLEFBQUMsQ0FBQywwQkFBbUIsR0FBQyxDQUFDLENBQUEiLCJmaWxlIjoiL1VzZXJzL3RzaHVzaGFuL2Rldi9MZW9uYXJkby90ZW1wb3V0TUM0d01ESTJNRGN6TXpjMk5qUTRNVEk0TURNei5qcyIsInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIGFjdGl2YXRvckRpcmVjdGl2ZSgkY29tcGlsZSkge1xuICByZXR1cm4ge1xuICAgIHJlc3RyaWN0OiAnQScsXG4gICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW0pIHtcbiAgICAgIHZhciBlbCA9IGFuZ3VsYXIuZWxlbWVudCgnPGRpdiBuZy1jbGljaz1cImFjdGl2YXRlKClcIiBjbGFzcz1cImxlb25hcmRvLWFjdGl2YXRvclwiPjwvZGl2PicpO1xuXG4gICAgICB2YXIgd2luID0gYW5ndWxhci5lbGVtZW50KFtcbiAgICAgICc8ZGl2IGNsYXNzPVwibGVvbmFyZG8td2luZG93XCI+JyxcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJsZW9uYXJkby1oZWFkZXJcIj5MZW9uYXJkbyBDb25maWd1cmF0aW9uPC9kaXY+JyxcbiAgICAgICAgICAnPHdpbmRvdy1ib2R5Pjwvd2luZG93LWJvZHk+JyxcbiAgICAgICAgJzwvZGl2PicsXG4gICAgICAnPC9kaXY+J1xuICAgICAgXS5qb2luKCcnKSk7XG5cbiAgICAgICRjb21waWxlKGVsKShzY29wZSk7XG4gICAgICAkY29tcGlsZSh3aW4pKHNjb3BlKTtcblxuICAgICAgZWxlbS5hcHBlbmQoZWwpO1xuICAgICAgZWxlbS5hcHBlbmQod2luKTtcblxuICAgICAgd2luWzBdLmFkZEV2ZW50TGlzdGVuZXIoICd3ZWJraXRUcmFuc2l0aW9uRW5kJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICghZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuY29udGFpbnMoJ3B1bGwtdG9wJykpe1xuICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZChcInB1bGwtdG9wLWNsb3NlZFwiKTtcbiAgICAgICAgfVxuICAgICAgfSwgZmFsc2UgKTtcblxuICAgICAgc2NvcGUuYWN0aXZhdGUgPSBmdW5jdGlvbigpe1xuICAgICAgICBpZiAoIWRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmNvbnRhaW5zKCdwdWxsLXRvcCcpKSB7XG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCdwdWxsLXRvcCcpO1xuICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgncHVsbC10b3AtY2xvc2VkJyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdwdWxsLXRvcCcpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYWN0aXZhdG9yRGlyZWN0aXZlIiwiZnVuY3Rpb24gY29uZmlndXJhdGlvblNlcnZpY2UoJHEsIGFjdGl2ZVN0YXRlc1N0b3JlLCAkaHR0cEJhY2tlbmQpIHtcbiAgdmFyIHN0YXRlcyA9IFtdO1xuICB2YXIgc3RhdGVSZXEgPSB7fTtcblxuICB2YXIgdXBzZXJ0T3B0aW9uID0gZnVuY3Rpb24oc3RhdGUsIG5hbWUsIGFjdGl2ZSkge1xuICAgIHZhciBfc3RhdGVzID0gZ2V0U3RhdGVzRnJvbVN0b3JlKCk7XG4gICAgX3N0YXRlc1tzdGF0ZV0gPSB7XG4gICAgICBuYW1lOiBuYW1lLFxuICAgICAgYWN0aXZlOiBhY3RpdmVcbiAgICB9O1xuXG4gICAgYWN0aXZlU3RhdGVzU3RvcmUuc2V0KCdzdGF0ZXMnLCBfc3RhdGVzKTtcblxuICAgIHJldHVybiBzeW5jKCk7XG4gIH07XG5cbiAgZnVuY3Rpb24gZ2V0U3RhdGVzRnJvbVN0b3JlKCl7XG4gICAgcmV0dXJuIGFjdGl2ZVN0YXRlc1N0b3JlLmdldCgnc3RhdGVzJykgfHwge307XG4gIH1cblxuICBmdW5jdGlvbiBmZXRjaFN0YXRlcygpe1xuICAgIHZhciBhY3RpdmVTdGF0ZXMgPSBnZXRTdGF0ZXNGcm9tU3RvcmUoKTtcbiAgICB2YXIgX3N0YXRlcyA9IHN0YXRlcy5tYXAoc3RhdGUgPT4gYW5ndWxhci5jb3B5KHN0YXRlKSk7XG5cbiAgICBfc3RhdGVzLmZvckVhY2goZnVuY3Rpb24oc3RhdGUpIHtcbiAgICAgIGxldCBvcHRpb24gPSBhY3RpdmVTdGF0ZXNbc3RhdGUubmFtZV07XG4gICAgICBzdGF0ZS5hY3RpdmUgPSAhIW9wdGlvbiAmJiBvcHRpb24uYWN0aXZlO1xuICAgICAgc3RhdGUuYWN0aXZlT3B0aW9uID0gISFvcHRpb24gPyBzdGF0ZS5vcHRpb25zLmZpbmQoX29wdGlvbiA9PiBfb3B0aW9uLm5hbWUgPT09IG9wdGlvbi5uYW1lKSA6IHN0YXRlLm9wdGlvbnNbMF07XG4gICAgfSk7XG5cbiAgICByZXR1cm4gX3N0YXRlcztcbiAgfVxuXG4gIGZ1bmN0aW9uIGRlYWN0aXZhdGVBbGwoKSB7XG4gICAgdmFyIF9zdGF0ZXMgPSBnZXRTdGF0ZXNGcm9tU3RvcmUoKTtcbiAgICBPYmplY3Qua2V5cyhfc3RhdGVzKS5mb3JFYWNoKGZ1bmN0aW9uKHN0YXRlS2V5KSB7XG4gICAgICBfc3RhdGVzW3N0YXRlS2V5XS5hY3RpdmUgPSBmYWxzZTtcbiAgICB9KTtcbiAgICBhY3RpdmVTdGF0ZXNTdG9yZS5zZXQoJ3N0YXRlcycsIF9zdGF0ZXMpO1xuXG4gICAgcmV0dXJuIHN5bmMoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpbmRTdGF0ZU9wdGlvbihuYW1lKXtcbiAgICByZXR1cm4gZmV0Y2hTdGF0ZXMoKS5maW5kKHN0YXRlID0+IHN0YXRlLm5hbWUgPT09IG5hbWUpLmFjdGl2ZU9wdGlvbjtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN5bmMoKXtcbiAgICBmZXRjaFN0YXRlcygpLmZvckVhY2goZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICB2YXIgb3B0aW9uID0gZmluZFN0YXRlT3B0aW9uKHN0YXRlLm5hbWUpO1xuICAgICAgaWYgKHN0YXRlLmFjdGl2ZSkge1xuICAgICAgICBzdGF0ZVJlcVtzdGF0ZS5uYW1lXS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAkaHR0cEJhY2tlbmQuZGVsYXkgPSBvcHRpb24uZGVsYXk7XG4gICAgICAgICAgcmV0dXJuIFtvcHRpb24uc3RhdHVzLCBvcHRpb24uZGF0YV07XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHN0YXRlUmVxW3N0YXRlLm5hbWVdLnBhc3NUaHJvdWdoKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIC8vY29uZmlndXJlZCBzdGF0ZXMgdG9kbyBkb2NcbiAgICBzdGF0ZXM6IHN0YXRlcyxcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpe1xuICAgICAgKGZldGNoU3RhdGVzKCkgfHwgW10pLmZvckVhY2goZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgIHN0YXRlUmVxW3N0YXRlLm5hbWVdID0gJGh0dHBCYWNrZW5kLndoZW4oc3RhdGUudmVyYiB8fCAnR0VUJywgbmV3IFJlZ0V4cChzdGF0ZS51cmwpKTtcbiAgICAgIH0pO1xuXG4gICAgICBzeW5jKCk7XG4gICAgfSxcbiAgICAvL3RvZG8gZG9jXG4gICAgYWN0aXZlX3N0YXRlc19vcHRpb246IFtdLFxuICAgIC8vdG9kbyBkb2NcbiAgICB1cHNlcnRPcHRpb246IHVwc2VydE9wdGlvbixcbiAgICAvL3RvZG8gZG9jXG4gICAgZmV0Y2hTdGF0ZXM6IGZldGNoU3RhdGVzLFxuICAgIGdldFN0YXRlOiBmdW5jdGlvbihuYW1lKXtcbiAgICAgIHZhciBzdGF0ZSA9IGZldGNoU3RhdGVzKCkuZmluZChzdGF0ZSA9PiBzdGF0ZS5uYW1lID09PSBuYW1lKTtcbiAgICAgIHJldHVybiAoc3RhdGUgJiYgc3RhdGUuYWN0aXZlICYmIGZpbmRTdGF0ZU9wdGlvbihuYW1lKSkgfHwgbnVsbDtcbiAgICB9LFxuICAgIGFkZFN0YXRlOiBmdW5jdGlvbihzdGF0ZU9iaikge1xuICAgICAgc3RhdGVPYmoub3B0aW9ucy5mb3JFYWNoKChvcHRpb24pID0+IHtcbiAgICAgICAgdGhpcy51cHNlcnQoe1xuICAgICAgICAgIHN0YXRlOiBzdGF0ZU9iai5uYW1lLFxuICAgICAgICAgIHVybDogc3RhdGVPYmoudXJsLFxuICAgICAgICAgIHZlcmI6IG9wdGlvbi52ZXJiLFxuICAgICAgICAgIG5hbWU6IG9wdGlvbi5uYW1lLFxuICAgICAgICAgIHN0YXR1czogb3B0aW9uLnN0YXR1cyxcbiAgICAgICAgICBkYXRhOiBvcHRpb24uZGF0YSxcbiAgICAgICAgICBkZWxheTogb3B0aW9uLmRlbGF5XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBhZGRTdGF0ZXM6IGZ1bmN0aW9uKHN0YXRlc0Fycikge1xuICAgICAgc3RhdGVzQXJyLmZvckVhY2goKHN0YXRlT2JqKSA9PiB7XG4gICAgICAgIHRoaXMuYWRkU3RhdGUoc3RhdGVPYmopO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICAvL2luc2VydCBvciByZXBsYWNlIGFuIG9wdGlvbiBieSBpbnNlcnQgb3IgdXBkYXRlaW5nIGEgc3RhdGUuXG4gICAgdXBzZXJ0OiBmdW5jdGlvbih7IHZlcmIsIHN0YXRlLCBuYW1lLCB1cmwsIHN0YXR1cyA9IDIwMCwgZGF0YSA9IHt9LCBkZWxheSA9IDB9KXtcbiAgICAgIHZhciBkZWZhdWx0U3RhdGUgPSB7fTtcblxuICAgICAgdmFyIGRlZmF1bHRPcHRpb24gPSB7fTtcblxuICAgICAgaWYgKCFzdGF0ZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhcImNhbm5vdCB1cHNlcnQgLSBzdGF0ZSBpcyBtYW5kYXRvcnlcIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdmFyIHN0YXRlSXRlbSA9IHN0YXRlcy5maW5kKF9zdGF0ZSA9PiBfc3RhdGUubmFtZSA9PT0gc3RhdGUpIHx8IGRlZmF1bHRTdGF0ZTtcblxuICAgICAgYW5ndWxhci5leHRlbmQoc3RhdGVJdGVtLCB7XG4gICAgICAgIG5hbWU6IHN0YXRlLFxuICAgICAgICB1cmw6IHVybCB8fCBzdGF0ZUl0ZW0udXJsLFxuICAgICAgICB2ZXJiOiB2ZXJiIHx8IHN0YXRlSXRlbS52ZXJiLFxuICAgICAgICBvcHRpb25zOiBzdGF0ZUl0ZW0ub3B0aW9ucyB8fCBbXVxuICAgICAgfSk7XG5cblxuICAgICAgaWYgKHN0YXRlSXRlbSA9PT0gZGVmYXVsdFN0YXRlKSB7XG4gICAgICAgIHN0YXRlcy5wdXNoKHN0YXRlSXRlbSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBvcHRpb24gPSBzdGF0ZUl0ZW0ub3B0aW9ucy5maW5kKF9vcHRpb24gPT4gX29wdGlvbi5uYW1lID09PSBuYW1lKSB8fCBkZWZhdWx0T3B0aW9uO1xuXG4gICAgICBhbmd1bGFyLmV4dGVuZChvcHRpb24sIHtcbiAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgc3RhdHVzOiBzdGF0dXMsXG4gICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgIGRlbGF5OiBkZWxheVxuICAgICAgfSk7XG5cbiAgICAgIGlmIChvcHRpb24gPT09IGRlZmF1bHRPcHRpb24pIHtcbiAgICAgICAgc3RhdGVJdGVtLm9wdGlvbnMucHVzaChvcHRpb24pO1xuICAgICAgfVxuICAgIH0sXG4gICAgLy90b2RvIGRvY1xuICAgIHVwc2VydE1hbnk6IGZ1bmN0aW9uKGl0ZW1zKXtcbiAgICAgIGl0ZW1zLmZvckVhY2goaXRlbSA9PiB0aGlzLnVwc2VydChpdGVtKSk7XG4gICAgfSxcbiAgICBkZWFjdGl2YXRlQWxsOiBkZWFjdGl2YXRlQWxsXG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNvbmZpZ3VyYXRpb25TZXJ2aWNlOyIsIi8vIFRoaXMgSXMgQSBIZWFkZXJcbi8vIC0tLS0tLS0tLS0tLS0tLS1cblxuXG4vLyBUaGlzIGlzIGEgbm9ybWFsIGNvbW1lbnQsIHRoYXQgd2lsbCBiZWNvbWUgcGFydCBvZiB0aGVcbi8vIGFubm90YXRpb25zIGFmdGVyIHJ1bm5pbmcgdGhyb3VnaCB0aGUgRG9jY28gdG9vbC4gVXNlIHRoaXNcbi8vIHNwYWNlIHRvIGRlc2NyaWJlIHRoZSBmdW5jdGlvbiBvciBvdGhlciBjb2RlIGp1c3QgYmVsb3dcbi8vIHRoaXMgY29tbWVudC4gRm9yIGV4YW1wbGU6XG4vL1xuLy8gVGhlIGBEb1NvbWV0aGluZ2AgbWV0aG9kIGRvZXMgc29tZXRoaW5nISBJdCBkb2Vzbid0IHRha2UgYW55XG4vLyBwYXJhbWV0ZXJzLi4uIGl0IGp1c3QgZG9lcyBzb21ldGhpbmcuXG5mdW5jdGlvbiB3aW5kb3dCb2R5RGlyZWN0aXZlKCRodHRwLCBjb25maWd1cmF0aW9uKSB7XG4gIHJldHVybiB7XG4gICAgcmVzdHJpY3Q6ICdFJyxcbiAgICB0ZW1wbGF0ZVVybDogJ3dpbmRvdy1ib2R5Lmh0bWwnLFxuICAgIHNjb3BlOiB0cnVlLFxuICAgIHJlcGxhY2U6IHRydWUsXG4gICAgY29udHJvbGxlcjogZnVuY3Rpb24oJHNjb3BlKXtcbiAgICAgICRzY29wZS5zZWxlY3RlZEl0ZW0gPSAnYWN0aXZhdGUnO1xuICAgICAgJHNjb3BlLk5vdGhhc1VybCA9IGZ1bmN0aW9uKG9wdGlvbil7XG4gICAgICAgIHJldHVybiAhb3B0aW9uLnVybDtcbiAgICAgIH07XG4gICAgICAkc2NvcGUuaGFzVXJsID0gZnVuY3Rpb24ob3B0aW9uKXtcbiAgICAgICAgcmV0dXJuICEhb3B0aW9uLnVybDtcbiAgICAgIH07XG5cbiAgICAgICRzY29wZS5kZWFjdGl2YXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICRzY29wZS5zdGF0ZXMuZm9yRWFjaChmdW5jdGlvbihzdGF0ZSl7XG4gICAgICAgICAgICBzdGF0ZS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbmZpZ3VyYXRpb24uZGVhY3RpdmF0ZUFsbCgpO1xuICAgICAgfTtcblxuICAgICAgJHNjb3BlLnVwZGF0ZVN0YXRlID0gZnVuY3Rpb24oc3RhdGUpe1xuICAgICAgICBjb25zb2xlLmxvZyhgdXBkYXRlIHN0YXRlOiAke3N0YXRlLm5hbWV9ICR7c3RhdGUuYWN0aXZlT3B0aW9uLm5hbWV9ICR7c3RhdGUuYWN0aXZlfWApO1xuICAgICAgICBjb25maWd1cmF0aW9uLnVwc2VydE9wdGlvbihzdGF0ZS5uYW1lLCBzdGF0ZS5hY3RpdmVPcHRpb24ubmFtZSwgc3RhdGUuYWN0aXZlKTtcbiAgICAgIH07XG5cbiAgICAgICRzY29wZS5zdGF0ZXMgPSBjb25maWd1cmF0aW9uLmZldGNoU3RhdGVzKCk7XG4gICAgfSxcbiAgICBsaW5rOiBmdW5jdGlvbihzY29wZSkge1xuICAgICAgc2NvcGUudGVzdCA9IHtcbiAgICAgICAgdXJsOiAnJyxcbiAgICAgICAgdmFsdWU6IHVuZGVmaW5lZFxuICAgICAgfTtcblxuICAgICAgc2NvcGUuc3VibWl0ID0gZnVuY3Rpb24odXJsKXtcbiAgICAgICAgc2NvcGUudGVzdC52YWx1ZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgc2NvcGUudXJsID0gdXJsO1xuICAgICAgICBpZiAodXJsKSB7XG4gICAgICAgICAgJGh0dHAuZ2V0KHVybCkuc3VjY2VzcyhmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICBzY29wZS50ZXN0LnZhbHVlID0gcmVzO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgd2luZG93Qm9keURpcmVjdGl2ZSIsImltcG9ydCBhY3RpdmF0b3JEaXJlY3RpdmUgZnJvbSAnLi9hY3RpdmF0b3IuZHJ2LmpzJztcbmltcG9ydCBjb25maWd1cmF0aW9uU2VydmljZSBmcm9tICcuL2NvbmZpZ3VyYXRpb24uc3J2LmpzJztcbmltcG9ydCB3aW5kb3dCb2R5RGlyZWN0aXZlIGZyb20gJy4vd2luZG93LWJvZHkuZHJ2LmpzJztcblxuZXhwb3J0IGRlZmF1bHQgYW5ndWxhci5tb2R1bGUoJ2xlb25hcmRvJywgWydsZW9uYXJkby50ZW1wbGF0ZXMnLCAnYW5ndWxhci1zdG9yYWdlJywgJ25nTW9ja0UyRSddKVxuICAuZmFjdG9yeSgnY29uZmlndXJhdGlvbicsIGNvbmZpZ3VyYXRpb25TZXJ2aWNlKVxuICAuZmFjdG9yeSgnYWN0aXZlU3RhdGVzU3RvcmUnLCBmdW5jdGlvbihzdG9yZSkge1xuICAgIHJldHVybiBzdG9yZS5nZXROYW1lc3BhY2VkU3RvcmUoJ2FjdGl2ZV9zdGF0ZXMnKTtcbiAgfSlcbiAgLmRpcmVjdGl2ZSgnYWN0aXZhdG9yJywgYWN0aXZhdG9yRGlyZWN0aXZlKVxuICAuZGlyZWN0aXZlKCd3aW5kb3dCb2R5Jywgd2luZG93Qm9keURpcmVjdGl2ZSlcbiAgLyogd3JhcCAkaHR0cGJhY2tlbmQgd2l0aCBhIHByb3h5IGluIG9yZGVyIHRvIHN1cHBvcnQgZGVsYXlpbmcgaXRzIHJlc3BvbnNlc1xuICAgKiB3ZSBhcmUgdXNpbmcgdGhlIGFwcHJvYWNoIGRlc2NyaWJlZCBpbiBFbmRsZXNzIEluZGlyZWN0aW9uOlxuICAgKiBodHRwczovL2VuZGxlc3NpbmRpcmVjdGlvbi53b3JkcHJlc3MuY29tLzIwMTMvMDUvMTgvYW5ndWxhcmpzLWRlbGF5LXJlc3BvbnNlLWZyb20taHR0cGJhY2tlbmQvXG4gICAqL1xuICAuY29uZmlnKGZ1bmN0aW9uKCRwcm92aWRlKSB7XG4gICAgJHByb3ZpZGUuZGVjb3JhdG9yKCckaHR0cEJhY2tlbmQnLCBmdW5jdGlvbigkZGVsZWdhdGUpIHtcbiAgICAgIHZhciBwcm94eSA9IGZ1bmN0aW9uKG1ldGhvZCwgdXJsLCBkYXRhLCBjYWxsYmFjaywgaGVhZGVycykge1xuICAgICAgICB2YXIgaW50ZXJjZXB0b3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzLFxuICAgICAgICAgICAgICBfYXJndW1lbnRzID0gYXJndW1lbnRzO1xuICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjYWxsYmFjay5hcHBseShfdGhpcywgX2FyZ3VtZW50cyk7XG4gICAgICAgICAgfSwgcHJveHkuZGVsYXkgfHwgMCk7XG4gICAgICAgICAgcHJveHkuZGVsYXkgPSAwO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gJGRlbGVnYXRlLmNhbGwodGhpcywgbWV0aG9kLCB1cmwsIGRhdGEsIGludGVyY2VwdG9yLCBoZWFkZXJzKTtcbiAgICAgIH07XG4gICAgICBmb3IodmFyIGtleSBpbiAkZGVsZWdhdGUpIHtcbiAgICAgICAgcHJveHlba2V5XSA9ICRkZWxlZ2F0ZVtrZXldO1xuICAgICAgfVxuICAgICAgcHJveHkuc2V0RGVsYXkgPSAoZGVsYXkpID0+IHtcbiAgICAgICAgcHJveHkuZGVsYXkgPSBkZWxheTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gcHJveHk7XG4gICAgfSk7XG4gIH0pO1xuXG4iXX0=

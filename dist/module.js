$traceurRuntime.options.symbols = true;
System.registerModule("src/leonardo/activator.drv.js", [], function() {
  "use strict";
  var __moduleName = "src/leonardo/activator.drv.js";
  function activatorDirective($compile) {
    return {
      restrict: 'A',
      link: function(scope, elem) {
        var el = angular.element('<div ng-click="activate()" class="leonardo-activator"></div>');
        var win = angular.element(['<div class="leonardo-window">', '<div class="leonardo-header">Leonardo Configuration</div>', '<window-body></window-body>', '</div>', '</div>'].join(''));
        $compile(el)(scope);
        $compile(win)(scope);
        elem.append(el);
        elem.append(win);
        win[0].addEventListener('webkitTransitionEnd', function() {
          if (!document.body.classList.contains('pull-top')) {
            document.body.classList.add("pull-top-closed");
          }
        }, false);
        scope.activate = function() {
          if (!document.body.classList.contains('pull-top')) {
            document.body.classList.add('pull-top');
            document.body.classList.remove('pull-top-closed');
          } else {
            document.body.classList.remove('pull-top');
          }
        };
      }
    };
  }
  var $__default = activatorDirective;
  return {get default() {
      return $__default;
    }};
});
$traceurRuntime.options.symbols = true;
System.registerModule("src/leonardo/configuration.srv.js", [], function() {
  "use strict";
  var __moduleName = "src/leonardo/configuration.srv.js";
  function configurationService($q, activeStatesStore, $httpBackend) {
    var states = [];
    var responseHandlers = {};
    var upsertOption = function(state, name, active) {
      var _states = getStatesFromStore();
      _states[$traceurRuntime.toProperty(state)] = {
        name: name,
        active: active
      };
      activeStatesStore.set('states', _states);
      sync();
    };
    function getStatesFromStore() {
      return activeStatesStore.get('states') || {};
    }
    function fetchStates() {
      var activeStates = getStatesFromStore();
      var _states = states.map((function(state) {
        return angular.copy(state);
      }));
      _states.forEach(function(state) {
        var option = activeStates[$traceurRuntime.toProperty(state.name)];
        state.active = !!option && option.active;
        state.activeOption = !!option ? state.options.find((function(_option) {
          return _option.name === option.name;
        })) : state.options[0];
      });
      return _states;
    }
    function deactivateAll() {
      var _states = getStatesFromStore();
      Object.keys(_states).forEach(function(stateKey) {
        _states[$traceurRuntime.toProperty(stateKey)].active = false;
      });
      activeStatesStore.set('states', _states);
      sync();
    }
    function findStateOption(name) {
      return fetchStates().find((function(state) {
        return state.name === name;
      })).activeOption;
    }
    function sync() {
      fetchStates().forEach(function(state) {
        var option,
            responseHandler;
        if (state.url) {
          option = findStateOption(state.name);
          responseHandler = getResponseHandler(state);
          if (state.active) {
            responseHandler.respond(function() {
              $httpBackend.setDelay(option.delay);
              return [option.status, angular.isFunction(option.data) ? option.data() : option.data];
            });
          } else {
            responseHandler.passThrough();
          }
        }
      });
    }
    function getResponseHandler(state) {
      if (!responseHandlers[$traceurRuntime.toProperty(state.name)]) {
        responseHandlers[$traceurRuntime.toProperty(state.name)] = $httpBackend.when(state.verb || 'GET', new RegExp(state.url));
      }
      return responseHandlers[$traceurRuntime.toProperty(state.name)];
    }
    return {
      states: states,
      active_states_option: [],
      upsertOption: upsertOption,
      fetchStates: fetchStates,
      getState: function(name) {
        var state = fetchStates().find((function(state) {
          return state.name === name;
        }));
        return (state && state.active && findStateOption(name)) || null;
      },
      addState: function(stateObj) {
        var $__0 = this;
        stateObj.options.forEach((function(option) {
          $__0.upsert({
            state: stateObj.name,
            url: stateObj.url,
            verb: option.verb,
            name: option.name,
            status: option.status,
            data: option.data,
            delay: option.delay
          });
        }));
      },
      addStates: function(statesArr) {
        var $__0 = this;
        statesArr.forEach((function(stateObj) {
          $__0.addState(stateObj);
        }));
      },
      upsert: function($__1) {
        var $__3,
            $__4,
            $__5;
        var $__2 = $__1,
            verb = $__2.verb,
            state = $__2.state,
            name = $__2.name,
            url = $__2.url,
            status = ($__3 = $__2.status) === void 0 ? 200 : $__3,
            data = ($__4 = $__2.data) === void 0 ? {} : $__4,
            delay = ($__5 = $__2.delay) === void 0 ? 0 : $__5;
        var defaultState = {};
        var defaultOption = {};
        if (!state) {
          console.log("cannot upsert - state is mandatory");
          return ;
        }
        var stateItem = states.find((function(_state) {
          return _state.name === state;
        })) || defaultState;
        angular.extend(stateItem, {
          name: state,
          url: url || stateItem.url,
          verb: verb || stateItem.verb,
          options: stateItem.options || []
        });
        if (stateItem === defaultState) {
          states.push(stateItem);
        }
        var option = stateItem.options.find((function(_option) {
          return _option.name === name;
        })) || defaultOption;
        angular.extend(option, {
          name: name,
          status: status,
          data: data,
          delay: delay
        });
        if (option === defaultOption) {
          stateItem.options.push(option);
        }
        sync();
      },
      upsertMany: function(items) {
        var $__0 = this;
        items.forEach((function(item) {
          return $__0.upsert(item);
        }));
      },
      deactivateAll: deactivateAll
    };
  }
  var $__default = configurationService;
  return {get default() {
      return $__default;
    }};
});
$traceurRuntime.options.symbols = true;
System.registerModule("src/leonardo/window-body.drv.js", [], function() {
  "use strict";
  var __moduleName = "src/leonardo/window-body.drv.js";
  function windowBodyDirective($http, configuration) {
    return {
      restrict: 'E',
      templateUrl: 'window-body.html',
      scope: true,
      replace: true,
      controller: function($scope) {
        $scope.selectedItem = 'activate';
        $scope.NothasUrl = function(option) {
          return !option.url;
        };
        $scope.hasUrl = function(option) {
          return !!option.url;
        };
        $scope.deactivate = function() {
          $scope.states.forEach(function(state) {
            state.active = false;
          });
          configuration.deactivateAll();
        };
        $scope.updateState = function(state) {
          console.log(("update state: " + state.name + " " + state.activeOption.name + " " + state.active));
          configuration.upsertOption(state.name, state.activeOption.name, state.active);
        };
        $scope.states = configuration.fetchStates();
      },
      link: function(scope) {
        scope.test = {
          url: '',
          value: undefined
        };
        scope.submit = function(url) {
          scope.test.value = undefined;
          scope.url = url;
          if (url) {
            $http.get(url).success(function(res) {
              scope.test.value = res;
            });
          }
        };
      }
    };
  }
  var $__default = windowBodyDirective;
  return {get default() {
      return $__default;
    }};
});
$traceurRuntime.options.symbols = true;
System.registerModule("src/leonardo/module.js", [], function() {
  "use strict";
  var __moduleName = "src/leonardo/module.js";
  var activatorDirective = System.get("src/leonardo/activator.drv.js").default;
  var configurationService = System.get("src/leonardo/configuration.srv.js").default;
  var windowBodyDirective = System.get("src/leonardo/window-body.drv.js").default;
  var $__default = angular.module('leonardo', ['leonardo.templates', 'angular-storage', 'ngMockE2E']).factory('configuration', configurationService).factory('activeStatesStore', function(store) {
    return store.getNamespacedStore('active_states');
  }).directive('activator', activatorDirective).directive('windowBody', windowBodyDirective).config(function($provide) {
    $provide.decorator('$httpBackend', function($delegate) {
      var proxy = function(method, url, data, callback, headers) {
        var interceptor = function() {
          var _this = this,
              _arguments = arguments;
          setTimeout(function() {
            callback.apply(_this, _arguments);
          }, proxy.delay || 0);
          proxy.delay = 0;
        };
        return $delegate.call(this, method, url, data, interceptor, headers);
      };
      for (var key in $delegate)
        if (!$traceurRuntime.isSymbolString(key)) {
          proxy[$traceurRuntime.toProperty(key)] = $delegate[$traceurRuntime.toProperty(key)];
        }
      proxy.setDelay = (function(delay) {
        proxy.delay = delay;
      });
      return proxy;
    });
  });
  return {get default() {
      return $__default;
    }};
});
System.get("src/leonardo/module.js" + '');
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9sZW9uYXJkby9hY3RpdmF0b3IuZHJ2LmpzIiwic3JjL2xlb25hcmRvL2NvbmZpZ3VyYXRpb24uc3J2LmpzIiwic3JjL2xlb25hcmRvL3dpbmRvdy1ib2R5LmRydi5qcyIsInNyYy9sZW9uYXJkby9tb2R1bGUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkEsYyxRLFEsRSxLLEM7QSxLLGUsQSxpQyxHLEMsVSxBOztBLEEsSSxDLFksa0MsQztBQUFBLFNBQVMsbUJBQWlCLENBQUUsUUFBTztBQUNqQyxTQUFPO0FBQ0wsYUFBTyxDQUFHLElBQUU7QUFDWixTQUFHLENBQUcsVUFBUyxLQUFJLENBQUcsQ0FBQSxJQUFHO0FBQ3ZCLEFBQUksVUFBQSxDQUFBLEVBQUMsRUFBSSxDQUFBLE9BQU0sUUFBUSxBQUFDLENBQUMsOERBQTZELENBQUMsQ0FBQztBQUV4RixBQUFJLFVBQUEsQ0FBQSxHQUFFLEVBQUksQ0FBQSxPQUFNLFFBQVEsQUFBQyxDQUFDLENBQzFCLCtCQUE4QixDQUM1Qiw0REFBMEQsQ0FDeEQsOEJBQTRCLENBQzlCLFNBQU8sQ0FDVCxTQUFPLENBQ1AsS0FBSyxBQUFDLENBQUMsRUFBQyxDQUFDLENBQUMsQ0FBQztBQUVYLGVBQU8sQUFBQyxDQUFDLEVBQUMsQ0FBQyxBQUFDLENBQUMsS0FBSSxDQUFDLENBQUM7QUFDbkIsZUFBTyxBQUFDLENBQUMsR0FBRSxDQUFDLEFBQUMsQ0FBQyxLQUFJLENBQUMsQ0FBQztBQUVwQixXQUFHLE9BQU8sQUFBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO0FBQ2YsV0FBRyxPQUFPLEFBQUMsQ0FBQyxHQUFFLENBQUMsQ0FBQztBQUVoQixVQUFFLENBQUUsQ0FBQSxDQUFDLGlCQUFpQixBQUFDLENBQUUscUJBQW9CLENBQUcsVUFBUyxBQUFELENBQUc7QUFDekQsYUFBSSxDQUFDLFFBQU8sS0FBSyxVQUFVLFNBQVMsQUFBQyxDQUFDLFVBQVMsQ0FBQyxDQUFFO0FBQ2hELG1CQUFPLEtBQUssVUFBVSxJQUFJ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UyxDQUFDLENBQUM7VUFDbkMsQ0FBRyxDQUFBLEtBQUksTUFBTSxHQUFLLEVBQUEsQ0FBQyxDQUFDO0FBQ3BCLGNBQUksTUFBTSxFQUFJLEVBQUEsQ0FBQztRQUNqQixDQUFDO0FBQ0QsYUFBTyxDQUFBLFNBQVEsS0FBSyxBQUFDLENBQUMsSUFBRyxDQUFHLE9BQUssQ0FBRyxJQUFFLENBQUcsS0FBRyxDQUFHLFlBQVUsQ0FBRyxRQUFNLENBQUMsQ0FBQztNQUN0RSxDQUFDO0FBQ0QsVUFBUSxHQUFBLENBQUEsR0FBRSxDQUFBLEVBQUssVUFBUTtBQTVCN0IsV0FBSSxDQUFDLGVBQWMsZUFBZSxBQUFDLEtBQWtCLENBNEJyQjtBQUN4QixjQUFJLENBN0JNLGVBQWMsV0FBVyxBQUFDLENBNkI5QixHQUFFLENBN0I4QyxDQUFDLEVBQS9ELENBNkJxQixTQUFRLENBN0JYLGVBQWMsV0FBVyxBQUFDLENBNkJiLEdBQUUsQ0E3QjZCLENBQUMsQUE2QjdCLENBQUM7UUFDN0I7QUE5QmtFLEFBK0JsRSxVQUFJLFNBQVMsSUFBSSxTQUFDLEtBQUksQ0FBTTtBQUMxQixZQUFJLE1BQU0sRUFBSSxNQUFJLENBQUM7TUFDckIsQ0FBQSxDQUFDO0FBQ0QsV0FBTyxNQUFJLENBQUM7SUFDZCxDQUFDLENBQUM7RUFDSixDQUFDLEFBcEM4QixDQUFBO0FBQWpDLFNBQUEsYUFBd0I7QUFBRSx1QkFBd0I7SUFBRSxFQUE3QjtBQUVqQixDQUZ3RCxDQUFDO0FBQS9ELEtBQUssSUFBSSxBQUFDLENBQUMsMEJBQW1CLEdBQUMsQ0FBQyxDQUFBIiwiZmlsZSI6Ii9Vc2Vycy90c2h1c2hhbi9kZXYvTGVvbmFyZG8vdGVtcG91dE1DNHhNRFV5TURReU1EQXpOekl3T1RrNE9BcmVkcmVkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gYWN0aXZhdG9yRGlyZWN0aXZlKCRjb21waWxlKSB7XG4gIHJldHVybiB7XG4gICAgcmVzdHJpY3Q6ICdBJyxcbiAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbSkge1xuICAgICAgdmFyIGVsID0gYW5ndWxhci5lbGVtZW50KCc8ZGl2IG5nLWNsaWNrPVwiYWN0aXZhdGUoKVwiIGNsYXNzPVwibGVvbmFyZG8tYWN0aXZhdG9yXCI+PC9kaXY+Jyk7XG5cbiAgICAgIHZhciB3aW4gPSBhbmd1bGFyLmVsZW1lbnQoW1xuICAgICAgJzxkaXYgY2xhc3M9XCJsZW9uYXJkby13aW5kb3dcIj4nLFxuICAgICAgICAnPGRpdiBjbGFzcz1cImxlb25hcmRvLWhlYWRlclwiPkxlb25hcmRvIENvbmZpZ3VyYXRpb248L2Rpdj4nLFxuICAgICAgICAgICc8d2luZG93LWJvZHk+PC93aW5kb3ctYm9keT4nLFxuICAgICAgICAnPC9kaXY+JyxcbiAgICAgICc8L2Rpdj4nXG4gICAgICBdLmpvaW4oJycpKTtcblxuICAgICAgJGNvbXBpbGUoZWwpKHNjb3BlKTtcbiAgICAgICRjb21waWxlKHdpbikoc2NvcGUpO1xuXG4gICAgICBlbGVtLmFwcGVuZChlbCk7XG4gICAgICBlbGVtLmFwcGVuZCh3aW4pO1xuXG4gICAgICB3aW5bMF0uYWRkRXZlbnRMaXN0ZW5lciggJ3dlYmtpdFRyYW5zaXRpb25FbmQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCFkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5jb250YWlucygncHVsbC10b3AnKSl7XG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKFwicHVsbC10b3AtY2xvc2VkXCIpO1xuICAgICAgICB9XG4gICAgICB9LCBmYWxzZSApO1xuXG4gICAgICBzY29wZS5hY3RpdmF0ZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIGlmICghZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuY29udGFpbnMoJ3B1bGwtdG9wJykpIHtcbiAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ3B1bGwtdG9wJyk7XG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdwdWxsLXRvcC1jbG9zZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ3B1bGwtdG9wJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBhY3RpdmF0b3JEaXJlY3RpdmUiLCJmdW5jdGlvbiBjb25maWd1cmF0aW9uU2VydmljZSgkcSwgYWN0aXZlU3RhdGVzU3RvcmUsICRodHRwQmFja2VuZCkge1xuICB2YXIgc3RhdGVzID0gW107XG4gIHZhciByZXNwb25zZUhhbmRsZXJzID0ge307XG5cbiAgdmFyIHVwc2VydE9wdGlvbiA9IGZ1bmN0aW9uKHN0YXRlLCBuYW1lLCBhY3RpdmUpIHtcbiAgICB2YXIgX3N0YXRlcyA9IGdldFN0YXRlc0Zyb21TdG9yZSgpO1xuICAgIF9zdGF0ZXNbc3RhdGVdID0ge1xuICAgICAgbmFtZTogbmFtZSxcbiAgICAgIGFjdGl2ZTogYWN0aXZlXG4gICAgfTtcblxuICAgIGFjdGl2ZVN0YXRlc1N0b3JlLnNldCgnc3RhdGVzJywgX3N0YXRlcyk7XG5cbiAgICBzeW5jKCk7XG4gIH07XG5cbiAgZnVuY3Rpb24gZ2V0U3RhdGVzRnJvbVN0b3JlKCl7XG4gICAgcmV0dXJuIGFjdGl2ZVN0YXRlc1N0b3JlLmdldCgnc3RhdGVzJykgfHwge307XG4gIH1cblxuICBmdW5jdGlvbiBmZXRjaFN0YXRlcygpe1xuICAgIHZhciBhY3RpdmVTdGF0ZXMgPSBnZXRTdGF0ZXNGcm9tU3RvcmUoKTtcbiAgICB2YXIgX3N0YXRlcyA9IHN0YXRlcy5tYXAoc3RhdGUgPT4gYW5ndWxhci5jb3B5KHN0YXRlKSk7XG5cbiAgICBfc3RhdGVzLmZvckVhY2goZnVuY3Rpb24oc3RhdGUpIHtcbiAgICAgIGxldCBvcHRpb24gPSBhY3RpdmVTdGF0ZXNbc3RhdGUubmFtZV07XG4gICAgICBzdGF0ZS5hY3RpdmUgPSAhIW9wdGlvbiAmJiBvcHRpb24uYWN0aXZlO1xuICAgICAgc3RhdGUuYWN0aXZlT3B0aW9uID0gISFvcHRpb24gPyBzdGF0ZS5vcHRpb25zLmZpbmQoX29wdGlvbiA9PiBfb3B0aW9uLm5hbWUgPT09IG9wdGlvbi5uYW1lKSA6IHN0YXRlLm9wdGlvbnNbMF07XG4gICAgfSk7XG5cbiAgICByZXR1cm4gX3N0YXRlcztcbiAgfVxuXG4gIGZ1bmN0aW9uIGRlYWN0aXZhdGVBbGwoKSB7XG4gICAgdmFyIF9zdGF0ZXMgPSBnZXRTdGF0ZXNGcm9tU3RvcmUoKTtcbiAgICBPYmplY3Qua2V5cyhfc3RhdGVzKS5mb3JFYWNoKGZ1bmN0aW9uKHN0YXRlS2V5KSB7XG4gICAgICBfc3RhdGVzW3N0YXRlS2V5XS5hY3RpdmUgPSBmYWxzZTtcbiAgICB9KTtcbiAgICBhY3RpdmVTdGF0ZXNTdG9yZS5zZXQoJ3N0YXRlcycsIF9zdGF0ZXMpO1xuXG4gICAgc3luYygpO1xuICB9XG5cbiAgZnVuY3Rpb24gZmluZFN0YXRlT3B0aW9uKG5hbWUpe1xuICAgIHJldHVybiBmZXRjaFN0YXRlcygpLmZpbmQoc3RhdGUgPT4gc3RhdGUubmFtZSA9PT0gbmFtZSkuYWN0aXZlT3B0aW9uO1xuICB9XG5cbiAgZnVuY3Rpb24gc3luYygpe1xuICAgIGZldGNoU3RhdGVzKCkuZm9yRWFjaChmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgIHZhciBvcHRpb24sIHJlc3BvbnNlSGFuZGxlcjtcbiAgICAgIGlmIChzdGF0ZS51cmwpIHtcbiAgICAgICAgb3B0aW9uID0gZmluZFN0YXRlT3B0aW9uKHN0YXRlLm5hbWUpO1xuICAgICAgICByZXNwb25zZUhhbmRsZXIgPSBnZXRSZXNwb25zZUhhbmRsZXIoc3RhdGUpO1xuICAgICAgICBpZiAoc3RhdGUuYWN0aXZlKSB7XG4gICAgICAgICAgcmVzcG9uc2VIYW5kbGVyLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJGh0dHBCYWNrZW5kLnNldERlbGF5KG9wdGlvbi5kZWxheSk7XG4gICAgICAgICAgICByZXR1cm4gW29wdGlvbi5zdGF0dXMsIGFuZ3VsYXIuaXNGdW5jdGlvbihvcHRpb24uZGF0YSkgPyBvcHRpb24uZGF0YSgpIDogb3B0aW9uLmRhdGFdO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc3BvbnNlSGFuZGxlci5wYXNzVGhyb3VnaCgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRSZXNwb25zZUhhbmRsZXIoc3RhdGUpIHtcbiAgICBpZiAoIXJlc3BvbnNlSGFuZGxlcnNbc3RhdGUubmFtZV0pIHtcbiAgICAgIHJlc3BvbnNlSGFuZGxlcnNbc3RhdGUubmFtZV0gPSAkaHR0cEJhY2tlbmQud2hlbihzdGF0ZS52ZXJiIHx8ICdHRVQnLCBuZXcgUmVnRXhwKHN0YXRlLnVybCkpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzcG9uc2VIYW5kbGVyc1tzdGF0ZS5uYW1lXTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgLy9jb25maWd1cmVkIHN0YXRlcyB0b2RvIGRvY1xuICAgIHN0YXRlczogc3RhdGVzLFxuICAgIC8vdG9kbyBkb2NcbiAgICBhY3RpdmVfc3RhdGVzX29wdGlvbjogW10sXG4gICAgLy90b2RvIGRvY1xuICAgIHVwc2VydE9wdGlvbjogdXBzZXJ0T3B0aW9uLFxuICAgIC8vdG9kbyBkb2NcbiAgICBmZXRjaFN0YXRlczogZmV0Y2hTdGF0ZXMsXG4gICAgZ2V0U3RhdGU6IGZ1bmN0aW9uKG5hbWUpe1xuICAgICAgdmFyIHN0YXRlID0gZmV0Y2hTdGF0ZXMoKS5maW5kKHN0YXRlID0+IHN0YXRlLm5hbWUgPT09IG5hbWUpO1xuICAgICAgcmV0dXJuIChzdGF0ZSAmJiBzdGF0ZS5hY3RpdmUgJiYgZmluZFN0YXRlT3B0aW9uKG5hbWUpKSB8fCBudWxsO1xuICAgIH0sXG4gICAgYWRkU3RhdGU6IGZ1bmN0aW9uKHN0YXRlT2JqKSB7XG4gICAgICBzdGF0ZU9iai5vcHRpb25zLmZvckVhY2goKG9wdGlvbikgPT4ge1xuICAgICAgICB0aGlzLnVwc2VydCh7XG4gICAgICAgICAgc3RhdGU6IHN0YXRlT2JqLm5hbWUsXG4gICAgICAgICAgdXJsOiBzdGF0ZU9iai51cmwsXG4gICAgICAgICAgdmVyYjogb3B0aW9uLnZlcmIsXG4gICAgICAgICAgbmFtZTogb3B0aW9uLm5hbWUsXG4gICAgICAgICAgc3RhdHVzOiBvcHRpb24uc3RhdHVzLFxuICAgICAgICAgIGRhdGE6IG9wdGlvbi5kYXRhLFxuICAgICAgICAgIGRlbGF5OiBvcHRpb24uZGVsYXlcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFkZFN0YXRlczogZnVuY3Rpb24oc3RhdGVzQXJyKSB7XG4gICAgICBzdGF0ZXNBcnIuZm9yRWFjaCgoc3RhdGVPYmopID0+IHtcbiAgICAgICAgdGhpcy5hZGRTdGF0ZShzdGF0ZU9iaik7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIC8vaW5zZXJ0IG9yIHJlcGxhY2UgYW4gb3B0aW9uIGJ5IGluc2VydCBvciB1cGRhdGVpbmcgYSBzdGF0ZS5cbiAgICB1cHNlcnQ6IGZ1bmN0aW9uKHsgdmVyYiwgc3RhdGUsIG5hbWUsIHVybCwgc3RhdHVzID0gMjAwLCBkYXRhID0ge30sIGRlbGF5ID0gMH0pe1xuICAgICAgdmFyIGRlZmF1bHRTdGF0ZSA9IHt9O1xuXG4gICAgICB2YXIgZGVmYXVsdE9wdGlvbiA9IHt9O1xuXG4gICAgICBpZiAoIXN0YXRlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiY2Fubm90IHVwc2VydCAtIHN0YXRlIGlzIG1hbmRhdG9yeVwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB2YXIgc3RhdGVJdGVtID0gc3RhdGVzLmZpbmQoX3N0YXRlID0+IF9zdGF0ZS5uYW1lID09PSBzdGF0ZSkgfHwgZGVmYXVsdFN0YXRlO1xuXG4gICAgICBhbmd1bGFyLmV4dGVuZChzdGF0ZUl0ZW0sIHtcbiAgICAgICAgbmFtZTogc3RhdGUsXG4gICAgICAgIHVybDogdXJsIHx8IHN0YXRlSXRlbS51cmwsXG4gICAgICAgIHZlcmI6IHZlcmIgfHwgc3RhdGVJdGVtLnZlcmIsXG4gICAgICAgIG9wdGlvbnM6IHN0YXRlSXRlbS5vcHRpb25zIHx8IFtdXG4gICAgICB9KTtcblxuXG4gICAgICBpZiAoc3RhdGVJdGVtID09PSBkZWZhdWx0U3RhdGUpIHtcbiAgICAgICAgc3RhdGVzLnB1c2goc3RhdGVJdGVtKTtcbiAgICAgIH1cblxuICAgICAgdmFyIG9wdGlvbiA9IHN0YXRlSXRlbS5vcHRpb25zLmZpbmQoX29wdGlvbiA9PiBfb3B0aW9uLm5hbWUgPT09IG5hbWUpIHx8IGRlZmF1bHRPcHRpb247XG5cbiAgICAgIGFuZ3VsYXIuZXh0ZW5kKG9wdGlvbiwge1xuICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICBzdGF0dXM6IHN0YXR1cyxcbiAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgZGVsYXk6IGRlbGF5XG4gICAgICB9KTtcblxuICAgICAgaWYgKG9wdGlvbiA9PT0gZGVmYXVsdE9wdGlvbikge1xuICAgICAgICBzdGF0ZUl0ZW0ub3B0aW9ucy5wdXNoKG9wdGlvbik7XG4gICAgICB9XG4gICAgICBzeW5jKCk7XG4gICAgfSxcbiAgICAvL3RvZG8gZG9jXG4gICAgdXBzZXJ0TWFueTogZnVuY3Rpb24oaXRlbXMpe1xuICAgICAgaXRlbXMuZm9yRWFjaChpdGVtID0+IHRoaXMudXBzZXJ0KGl0ZW0pKTtcbiAgICB9LFxuICAgIGRlYWN0aXZhdGVBbGw6IGRlYWN0aXZhdGVBbGxcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY29uZmlndXJhdGlvblNlcnZpY2U7IiwiLy8gVGhpcyBJcyBBIEhlYWRlclxuLy8gLS0tLS0tLS0tLS0tLS0tLVxuXG5cbi8vIFRoaXMgaXMgYSBub3JtYWwgY29tbWVudCwgdGhhdCB3aWxsIGJlY29tZSBwYXJ0IG9mIHRoZVxuLy8gYW5ub3RhdGlvbnMgYWZ0ZXIgcnVubmluZyB0aHJvdWdoIHRoZSBEb2NjbyB0b29sLiBVc2UgdGhpc1xuLy8gc3BhY2UgdG8gZGVzY3JpYmUgdGhlIGZ1bmN0aW9uIG9yIG90aGVyIGNvZGUganVzdCBiZWxvd1xuLy8gdGhpcyBjb21tZW50LiBGb3IgZXhhbXBsZTpcbi8vXG4vLyBUaGUgYERvU29tZXRoaW5nYCBtZXRob2QgZG9lcyBzb21ldGhpbmchIEl0IGRvZXNuJ3QgdGFrZSBhbnlcbi8vIHBhcmFtZXRlcnMuLi4gaXQganVzdCBkb2VzIHNvbWV0aGluZy5cbmZ1bmN0aW9uIHdpbmRvd0JvZHlEaXJlY3RpdmUoJGh0dHAsIGNvbmZpZ3VyYXRpb24pIHtcbiAgcmV0dXJuIHtcbiAgICByZXN0cmljdDogJ0UnLFxuICAgIHRlbXBsYXRlVXJsOiAnd2luZG93LWJvZHkuaHRtbCcsXG4gICAgc2NvcGU6IHRydWUsXG4gICAgcmVwbGFjZTogdHJ1ZSxcbiAgICBjb250cm9sbGVyOiBmdW5jdGlvbigkc2NvcGUpe1xuICAgICAgJHNjb3BlLnNlbGVjdGVkSXRlbSA9ICdhY3RpdmF0ZSc7XG4gICAgICAkc2NvcGUuTm90aGFzVXJsID0gZnVuY3Rpb24ob3B0aW9uKXtcbiAgICAgICAgcmV0dXJuICFvcHRpb24udXJsO1xuICAgICAgfTtcbiAgICAgICRzY29wZS5oYXNVcmwgPSBmdW5jdGlvbihvcHRpb24pe1xuICAgICAgICByZXR1cm4gISFvcHRpb24udXJsO1xuICAgICAgfTtcblxuICAgICAgJHNjb3BlLmRlYWN0aXZhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgJHNjb3BlLnN0YXRlcy5mb3JFYWNoKGZ1bmN0aW9uKHN0YXRlKXtcbiAgICAgICAgICAgIHN0YXRlLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uZmlndXJhdGlvbi5kZWFjdGl2YXRlQWxsKCk7XG4gICAgICB9O1xuXG4gICAgICAkc2NvcGUudXBkYXRlU3RhdGUgPSBmdW5jdGlvbihzdGF0ZSl7XG4gICAgICAgIGNvbnNvbGUubG9nKGB1cGRhdGUgc3RhdGU6ICR7c3RhdGUubmFtZX0gJHtzdGF0ZS5hY3RpdmVPcHRpb24ubmFtZX0gJHtzdGF0ZS5hY3RpdmV9YCk7XG4gICAgICAgIGNvbmZpZ3VyYXRpb24udXBzZXJ0T3B0aW9uKHN0YXRlLm5hbWUsIHN0YXRlLmFjdGl2ZU9wdGlvbi5uYW1lLCBzdGF0ZS5hY3RpdmUpO1xuICAgICAgfTtcblxuICAgICAgJHNjb3BlLnN0YXRlcyA9IGNvbmZpZ3VyYXRpb24uZmV0Y2hTdGF0ZXMoKTtcbiAgICB9LFxuICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlKSB7XG4gICAgICBzY29wZS50ZXN0ID0ge1xuICAgICAgICB1cmw6ICcnLFxuICAgICAgICB2YWx1ZTogdW5kZWZpbmVkXG4gICAgICB9O1xuXG4gICAgICBzY29wZS5zdWJtaXQgPSBmdW5jdGlvbih1cmwpe1xuICAgICAgICBzY29wZS50ZXN0LnZhbHVlID0gdW5kZWZpbmVkO1xuICAgICAgICBzY29wZS51cmwgPSB1cmw7XG4gICAgICAgIGlmICh1cmwpIHtcbiAgICAgICAgICAkaHR0cC5nZXQodXJsKS5zdWNjZXNzKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIHNjb3BlLnRlc3QudmFsdWUgPSByZXM7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCB3aW5kb3dCb2R5RGlyZWN0aXZlIiwiaW1wb3J0IGFjdGl2YXRvckRpcmVjdGl2ZSBmcm9tICcuL2FjdGl2YXRvci5kcnYuanMnO1xuaW1wb3J0IGNvbmZpZ3VyYXRpb25TZXJ2aWNlIGZyb20gJy4vY29uZmlndXJhdGlvbi5zcnYuanMnO1xuaW1wb3J0IHdpbmRvd0JvZHlEaXJlY3RpdmUgZnJvbSAnLi93aW5kb3ctYm9keS5kcnYuanMnO1xuXG5leHBvcnQgZGVmYXVsdCBhbmd1bGFyLm1vZHVsZSgnbGVvbmFyZG8nLCBbJ2xlb25hcmRvLnRlbXBsYXRlcycsICdhbmd1bGFyLXN0b3JhZ2UnLCAnbmdNb2NrRTJFJ10pXG4gIC5mYWN0b3J5KCdjb25maWd1cmF0aW9uJywgY29uZmlndXJhdGlvblNlcnZpY2UpXG4gIC5mYWN0b3J5KCdhY3RpdmVTdGF0ZXNTdG9yZScsIGZ1bmN0aW9uKHN0b3JlKSB7XG4gICAgcmV0dXJuIHN0b3JlLmdldE5hbWVzcGFjZWRTdG9yZSgnYWN0aXZlX3N0YXRlcycpO1xuICB9KVxuICAuZGlyZWN0aXZlKCdhY3RpdmF0b3InLCBhY3RpdmF0b3JEaXJlY3RpdmUpXG4gIC5kaXJlY3RpdmUoJ3dpbmRvd0JvZHknLCB3aW5kb3dCb2R5RGlyZWN0aXZlKVxuICAvKiB3cmFwICRodHRwYmFja2VuZCB3aXRoIGEgcHJveHkgaW4gb3JkZXIgdG8gc3VwcG9ydCBkZWxheWluZyBpdHMgcmVzcG9uc2VzXG4gICAqIHdlIGFyZSB1c2luZyB0aGUgYXBwcm9hY2ggZGVzY3JpYmVkIGluIEVuZGxlc3MgSW5kaXJlY3Rpb246XG4gICAqIGh0dHBzOi8vZW5kbGVzc2luZGlyZWN0aW9uLndvcmRwcmVzcy5jb20vMjAxMy8wNS8xOC9hbmd1bGFyanMtZGVsYXktcmVzcG9uc2UtZnJvbS1odHRwYmFja2VuZC9cbiAgICovXG4gIC5jb25maWcoZnVuY3Rpb24oJHByb3ZpZGUpIHtcbiAgICAkcHJvdmlkZS5kZWNvcmF0b3IoJyRodHRwQmFja2VuZCcsIGZ1bmN0aW9uKCRkZWxlZ2F0ZSkge1xuICAgICAgdmFyIHByb3h5ID0gZnVuY3Rpb24obWV0aG9kLCB1cmwsIGRhdGEsIGNhbGxiYWNrLCBoZWFkZXJzKSB7XG4gICAgICAgIHZhciBpbnRlcmNlcHRvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXMsXG4gICAgICAgICAgICAgIF9hcmd1bWVudHMgPSBhcmd1bWVudHM7XG4gICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KF90aGlzLCBfYXJndW1lbnRzKTtcbiAgICAgICAgICB9LCBwcm94eS5kZWxheSB8fCAwKTtcbiAgICAgICAgICBwcm94eS5kZWxheSA9IDA7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiAkZGVsZWdhdGUuY2FsbCh0aGlzLCBtZXRob2QsIHVybCwgZGF0YSwgaW50ZXJjZXB0b3IsIGhlYWRlcnMpO1xuICAgICAgfTtcbiAgICAgIGZvcih2YXIga2V5IGluICRkZWxlZ2F0ZSkge1xuICAgICAgICBwcm94eVtrZXldID0gJGRlbGVnYXRlW2tleV07XG4gICAgICB9XG4gICAgICBwcm94eS5zZXREZWxheSA9IChkZWxheSkgPT4ge1xuICAgICAgICBwcm94eS5kZWxheSA9IGRlbGF5O1xuICAgICAgfTtcbiAgICAgIHJldHVybiBwcm94eTtcbiAgICB9KTtcbiAgfSk7XG5cbiJdfQ==

$traceurRuntime.options.symbols = true;
var $__src_47_leonardo_47_activator_46_drv_46_js__ = (function() {
  "use strict";
  var __moduleName = "src/leonardo/activator.drv.js";
  function activatorDirective($compile) {
    return {
      restrict: 'A',
      link: function(scope, elem) {
        var el = angular.element('<div ng-click="activate()" class="leonardo-activator"></div>');
        var win = angular.element(['<div class="leonardo-window">', '<div class="leonardo-header">Leonardo Configuration</div>', '<window-body></window-body>', '</div>', '</div>'].join(''));
        $compile(el)(scope);
        $compile(win)(scope);
        elem.append(el);
        elem.append(win);
        win[0].addEventListener('webkitTransitionEnd', function() {
          if (!document.body.classList.contains('pull-top')) {
            document.body.classList.add("pull-top-closed");
          }
        }, false);
        scope.activate = function() {
          if (!document.body.classList.contains('pull-top')) {
            document.body.classList.add('pull-top');
            document.body.classList.remove('pull-top-closed');
          } else {
            document.body.classList.remove('pull-top');
          }
        };
      }
    };
  }
  var $__default = activatorDirective;
  return {get default() {
      return $__default;
    }};
})();
$traceurRuntime.options.symbols = true;
var $__src_47_leonardo_47_configuration_46_srv_46_js__ = (function() {
  "use strict";
  var __moduleName = "src/leonardo/configuration.srv.js";
  function configurationService(storage, $httpBackend) {
    var states = [];
    var responseHandlers = {};
    var upsertOption = function(state, name, active) {
      var _states = storage.getStates();
      _states[$traceurRuntime.toProperty(state)] = {
        name: name,
        active: active
      };
      storage.setStates(_states);
      sync();
    };
    function fetchStates() {
      var activeStates = storage.getStates();
      var _states = states.map(function(state) {
        return angular.copy(state);
      });
      _states.forEach(function(state) {
        var option = activeStates[$traceurRuntime.toProperty(state.name)];
        state.active = !!option && option.active;
        state.activeOption = !!option ? state.options.find(function(_option) {
          return _option.name === option.name;
        }) : state.options[0];
      });
      return _states;
    }
    function deactivateAll() {
      var _states = storage.getStates();
      Object.keys(_states).forEach(function(stateKey) {
        _states[$traceurRuntime.toProperty(stateKey)].active = false;
      });
      storage.setStates(_states);
      sync();
    }
    function findStateOption(name) {
      return fetchStates().find(function(state) {
        return state.name === name;
      }).activeOption;
    }
    function sync() {
      fetchStates().forEach(function(state) {
        var option,
            responseHandler;
        if (state.url) {
          option = findStateOption(state.name);
          responseHandler = getResponseHandler(state);
          if (state.active) {
            responseHandler.respond(function() {
              $httpBackend.setDelay(option.delay);
              return [option.status, angular.isFunction(option.data) ? option.data() : option.data];
            });
          } else {
            responseHandler.passThrough();
          }
        }
      });
    }
    function getResponseHandler(state) {
      if (!responseHandlers[$traceurRuntime.toProperty(state.name)]) {
        responseHandlers[$traceurRuntime.toProperty(state.name)] = $httpBackend.when(state.verb || 'GET', new RegExp(state.url));
      }
      return responseHandlers[$traceurRuntime.toProperty(state.name)];
    }
    return {
      states: states,
      active_states_option: [],
      upsertOption: upsertOption,
      fetchStates: fetchStates,
      getState: function(name) {
        var state = fetchStates().find(function(state) {
          return state.name === name;
        });
        return (state && state.active && findStateOption(name)) || null;
      },
      addState: function(stateObj) {
        var $__1 = this;
        stateObj.options.forEach(function(option) {
          $__1.upsert({
            state: stateObj.name,
            url: stateObj.url,
            verb: option.verb,
            name: option.name,
            status: option.status,
            data: option.data,
            delay: option.delay
          });
        });
      },
      addStates: function(statesArr) {
        var $__1 = this;
        statesArr.forEach(function(stateObj) {
          $__1.addState(stateObj);
        });
      },
      upsert: function($__2) {
        var $__4,
            $__5,
            $__6;
        var $__3 = $__2,
            verb = $__3.verb,
            state = $__3.state,
            name = $__3.name,
            url = $__3.url,
            status = ($__4 = $__3.status) === void 0 ? 200 : $__4,
            data = ($__5 = $__3.data) === void 0 ? {} : $__5,
            delay = ($__6 = $__3.delay) === void 0 ? 0 : $__6;
        var defaultState = {};
        var defaultOption = {};
        if (!state) {
          console.log("cannot upsert - state is mandatory");
          return;
        }
        var stateItem = states.find(function(_state) {
          return _state.name === state;
        }) || defaultState;
        angular.extend(stateItem, {
          name: state,
          url: url || stateItem.url,
          verb: verb || stateItem.verb,
          options: stateItem.options || []
        });
        if (stateItem === defaultState) {
          states.push(stateItem);
        }
        var option = stateItem.options.find(function(_option) {
          return _option.name === name;
        }) || defaultOption;
        angular.extend(option, {
          name: name,
          status: status,
          data: data,
          delay: delay
        });
        if (option === defaultOption) {
          stateItem.options.push(option);
        }
        sync();
      },
      upsertMany: function(items) {
        var $__1 = this;
        items.forEach(function(item) {
          return $__1.upsert(item);
        });
      },
      deactivateAll: deactivateAll
    };
  }
  var $__default = configurationService;
  return {get default() {
      return $__default;
    }};
})();
$traceurRuntime.options.symbols = true;
var $__src_47_leonardo_47_storage_46_srv_46_js__ = (function() {
  "use strict";
  var __moduleName = "src/leonardo/storage.srv.js";
  function storageService() {
    var STATES_STORE_KEY = 'states';
    function getItem(key) {
      var item = localStorage.getItem(key);
      if (!item) {
        return null;
      }
      return angular.fromJson(item);
    }
    function setItem(key, data) {
      localStorage.setItem(key, angular.toJson(data));
    }
    function getStates() {
      return getItem(STATES_STORE_KEY) || {};
    }
    function setStates(states) {
      setItem(STATES_STORE_KEY, states);
    }
    return {
      getItem: getItem,
      setItem: setItem,
      setStates: setStates,
      getStates: getStates
    };
  }
  var $__default = storageService;
  return {get default() {
      return $__default;
    }};
})();
$traceurRuntime.options.symbols = true;
var $__src_47_leonardo_47_window_45_body_46_drv_46_js__ = (function() {
  "use strict";
  var __moduleName = "src/leonardo/window-body.drv.js";
  function windowBodyDirective($http, configuration) {
    return {
      restrict: 'E',
      templateUrl: 'window-body.html',
      scope: true,
      replace: true,
      controller: function($scope) {
        $scope.selectedItem = 'activate';
        $scope.NothasUrl = function(option) {
          return !option.url;
        };
        $scope.hasUrl = function(option) {
          return !!option.url;
        };
        $scope.deactivate = function() {
          $scope.states.forEach(function(state) {
            state.active = false;
          });
          configuration.deactivateAll();
        };
        $scope.updateState = function(state) {
          console.log(("update state: " + state.name + " " + state.activeOption.name + " " + state.active));
          configuration.upsertOption(state.name, state.activeOption.name, state.active);
        };
        $scope.states = configuration.fetchStates();
      },
      link: function(scope) {
        scope.test = {
          url: '',
          value: undefined
        };
        scope.submit = function(url) {
          scope.test.value = undefined;
          scope.url = url;
          if (url) {
            $http.get(url).success(function(res) {
              scope.test.value = res;
            });
          }
        };
      }
    };
  }
  var $__default = windowBodyDirective;
  return {get default() {
      return $__default;
    }};
})();
$traceurRuntime.options.symbols = true;
var $__src_47_leonardo_47_module_46_js__ = (function() {
  "use strict";
  var __moduleName = "src/leonardo/module.js";
  var activatorDirective = ($__src_47_leonardo_47_activator_46_drv_46_js__).default;
  var configurationService = ($__src_47_leonardo_47_configuration_46_srv_46_js__).default;
  var storageService = ($__src_47_leonardo_47_storage_46_srv_46_js__).default;
  var windowBodyDirective = ($__src_47_leonardo_47_window_45_body_46_drv_46_js__).default;
  var $__default = angular.module('leonardo', ['leonardo.templates', 'ngMockE2E']).factory('storage', storageService).factory('configuration', configurationService).directive('activator', activatorDirective).directive('windowBody', windowBodyDirective).config(function($provide) {
    $provide.decorator('$httpBackend', function($delegate) {
      var proxy = function(method, url, data, callback, headers) {
        var interceptor = function() {
          var _this = this,
              _arguments = arguments;
          setTimeout(function() {
            callback.apply(_this, _arguments);
          }, proxy.delay || 0);
          proxy.delay = 0;
        };
        return $delegate.call(this, method, url, data, interceptor, headers);
      };
      for (var key in $delegate)
        if (!$traceurRuntime.isSymbolString(key)) {
          proxy[$traceurRuntime.toProperty(key)] = $delegate[$traceurRuntime.toProperty(key)];
        }
      proxy.setDelay = function(delay) {
        proxy.delay = delay;
      };
      return proxy;
    });
  });
  return {get default() {
      return $__default;
    }};
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIiIsInNyYy9sZW9uYXJkby9hY3RpdmF0b3IuZHJ2LmpzIiwic3JjL2xlb25hcmRvL2NvbmZpZ3VyYXRpb24uc3J2LmpzIiwic3JjL2xlb25hcmRvL3N0b3JhZ2Uuc3J2LmpzIiwic3JjL2xlb25hcmRvL3dpbmRvdy1ib2R5LmRydi5qcyIsInNyYy9sZW9uYXJkby9tb2R1bGUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsY0FBYyxRQUFRLFFBQVEsRUFBSSxLQUFHLENBQUE7OztBQUFyQyxBQUFJLElBQUEsQ0FBQSxZQUFXLGtDQUFvQixDQUFDO0FDQXBDLFNBQVMsbUJBQWlCLENBQUUsUUFBTztBQUNqQyxTQUFPO0FBQ0wsYUFBTyxDQUFHLElBQUU7QUFDWixTQUFHLENBQUcsVUFBUyxLQUFJLENBQUcsQ0FBQSxJQUFHO0FBQ3ZCLEFBQUksVUFBQSxDQUFBLEVBQUMsRUFBSSxDQUFBLE9BQU0sUUFBUSxBQUFDLENBQUMsOERBQTZELENBQUMsQ0FBQztBQUV4RixBQUFJLFVBQUEsQ0FBQSxHQUFFLEVBQUksQ0FBQSxPQUFNLFFBQVEsQUFBQyxDQUFDLENBQzFCLCtCQUE4QixDQUM1Qiw0REFBMEQsQ0FDeEQsOEJBQTRCLENBQzlCLFNBQU8sQ0FDVCxTQUFPLENBQ1AsS0FBSyxBQUFDLENBQUMsRUFBQyxDQUFDLENBQUMsQ0FBQztBQUVYLGVBQU8sQUFBQyxDQUFDLEVBQUMsQ0FBQyxBQUFDLENBQUMsS0FBSSxDQUFDLENBQUM7QUFDbkIsZUFBTyxBQUFDLENBQUMsR0FBRSxDQUFDLEFBQUMsQ0FBQyxLQUFJLENBQUMsQ0FBQztBQUVwQixXQUFHLE9BQU8sQUFBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO0FBQ2YsV0FBRyxPQUFPLEFBQUMsQ0FBQyxHQUFFLENBQUMsQ0FBQztBQUVoQixVQUFFLENBQUUsQ0FBQSxDQUFDLGlCQUFpQixBQUFDLENBQUUscUJBQW9CLENBQUcsVUFBUyxBQUFELENBQUc7QUFDekQsYUFBSSxDQUFDLFFBQU8sS0FBSyxV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LFVBQUksU0FBUyxFQUFJLFVBQUMsS0FBSSxDQUFNO0FBQzFCLFlBQUksTUFBTSxFQUFJLE1BQUksQ0FBQztNQUNyQixDQUFDO0FBQ0QsV0FBTyxNQUFJLENBQUM7SUFDZCxDQUFDLENBQUM7RUFDSixDQUFDLEFBbkM4QixDQUFBO0FBQWpDLFNBQUEsYUFBd0I7QUFBRSx1QkFBd0I7SUFBRSxFQUE3QiIsImZpbGUiOiIvVXNlcnMvc2ZyYW5rZWwvZGV2L291dGJyYWluL0xlb25hcmRvL3RlbXBvdXRNQzR4TVRjd09UVXdNalF6TWpRNU5UTTFOZ3JlZHJlZC5qcyIsInNvdXJjZXNDb250ZW50IjpbbnVsbCwiZnVuY3Rpb24gYWN0aXZhdG9yRGlyZWN0aXZlKCRjb21waWxlKSB7XG4gIHJldHVybiB7XG4gICAgcmVzdHJpY3Q6ICdBJyxcbiAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbSkge1xuICAgICAgdmFyIGVsID0gYW5ndWxhci5lbGVtZW50KCc8ZGl2IG5nLWNsaWNrPVwiYWN0aXZhdGUoKVwiIGNsYXNzPVwibGVvbmFyZG8tYWN0aXZhdG9yXCI+PC9kaXY+Jyk7XG5cbiAgICAgIHZhciB3aW4gPSBhbmd1bGFyLmVsZW1lbnQoW1xuICAgICAgJzxkaXYgY2xhc3M9XCJsZW9uYXJkby13aW5kb3dcIj4nLFxuICAgICAgICAnPGRpdiBjbGFzcz1cImxlb25hcmRvLWhlYWRlclwiPkxlb25hcmRvIENvbmZpZ3VyYXRpb248L2Rpdj4nLFxuICAgICAgICAgICc8d2luZG93LWJvZHk+PC93aW5kb3ctYm9keT4nLFxuICAgICAgICAnPC9kaXY+JyxcbiAgICAgICc8L2Rpdj4nXG4gICAgICBdLmpvaW4oJycpKTtcblxuICAgICAgJGNvbXBpbGUoZWwpKHNjb3BlKTtcbiAgICAgICRjb21waWxlKHdpbikoc2NvcGUpO1xuXG4gICAgICBlbGVtLmFwcGVuZChlbCk7XG4gICAgICBlbGVtLmFwcGVuZCh3aW4pO1xuXG4gICAgICB3aW5bMF0uYWRkRXZlbnRMaXN0ZW5lciggJ3dlYmtpdFRyYW5zaXRpb25FbmQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCFkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5jb250YWlucygncHVsbC10b3AnKSl7XG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKFwicHVsbC10b3AtY2xvc2VkXCIpO1xuICAgICAgICB9XG4gICAgICB9LCBmYWxzZSApO1xuXG4gICAgICBzY29wZS5hY3RpdmF0ZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIGlmICghZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuY29udGFpbnMoJ3B1bGwtdG9wJykpIHtcbiAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ3B1bGwtdG9wJyk7XG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdwdWxsLXRvcC1jbG9zZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ3B1bGwtdG9wJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBhY3RpdmF0b3JEaXJlY3RpdmUiLCJmdW5jdGlvbiBjb25maWd1cmF0aW9uU2VydmljZShzdG9yYWdlLCAkaHR0cEJhY2tlbmQpIHtcbiAgdmFyIHN0YXRlcyA9IFtdO1xuICB2YXIgcmVzcG9uc2VIYW5kbGVycyA9IHt9O1xuXG4gIHZhciB1cHNlcnRPcHRpb24gPSBmdW5jdGlvbihzdGF0ZSwgbmFtZSwgYWN0aXZlKSB7XG4gICAgdmFyIF9zdGF0ZXMgPSBzdG9yYWdlLmdldFN0YXRlcygpO1xuICAgIF9zdGF0ZXNbc3RhdGVdID0ge1xuICAgICAgbmFtZTogbmFtZSxcbiAgICAgIGFjdGl2ZTogYWN0aXZlXG4gICAgfTtcblxuICAgIHN0b3JhZ2Uuc2V0U3RhdGVzKF9zdGF0ZXMpO1xuXG4gICAgc3luYygpO1xuICB9O1xuXG4gIGZ1bmN0aW9uIGZldGNoU3RhdGVzKCl7XG4gICAgdmFyIGFjdGl2ZVN0YXRlcyA9IHN0b3JhZ2UuZ2V0U3RhdGVzKCk7XG4gICAgdmFyIF9zdGF0ZXMgPSBzdGF0ZXMubWFwKHN0YXRlID0+IGFuZ3VsYXIuY29weShzdGF0ZSkpO1xuXG4gICAgX3N0YXRlcy5mb3JFYWNoKGZ1bmN0aW9uKHN0YXRlKSB7XG4gICAgICBsZXQgb3B0aW9uID0gYWN0aXZlU3RhdGVzW3N0YXRlLm5hbWVdO1xuICAgICAgc3RhdGUuYWN0aXZlID0gISFvcHRpb24gJiYgb3B0aW9uLmFjdGl2ZTtcbiAgICAgIHN0YXRlLmFjdGl2ZU9wdGlvbiA9ICEhb3B0aW9uID8gc3RhdGUub3B0aW9ucy5maW5kKF9vcHRpb24gPT4gX29wdGlvbi5uYW1lID09PSBvcHRpb24ubmFtZSkgOiBzdGF0ZS5vcHRpb25zWzBdO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIF9zdGF0ZXM7XG4gIH1cblxuICBmdW5jdGlvbiBkZWFjdGl2YXRlQWxsKCkge1xuICAgIHZhciBfc3RhdGVzID0gc3RvcmFnZS5nZXRTdGF0ZXMoKTtcbiAgICBPYmplY3Qua2V5cyhfc3RhdGVzKS5mb3JFYWNoKGZ1bmN0aW9uKHN0YXRlS2V5KSB7XG4gICAgICBfc3RhdGVzW3N0YXRlS2V5XS5hY3RpdmUgPSBmYWxzZTtcbiAgICB9KTtcbiAgICBzdG9yYWdlLnNldFN0YXRlcyhfc3RhdGVzKTtcblxuICAgIHN5bmMoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpbmRTdGF0ZU9wdGlvbihuYW1lKXtcbiAgICByZXR1cm4gZmV0Y2hTdGF0ZXMoKS5maW5kKHN0YXRlID0+IHN0YXRlLm5hbWUgPT09IG5hbWUpLmFjdGl2ZU9wdGlvbjtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN5bmMoKXtcbiAgICBmZXRjaFN0YXRlcygpLmZvckVhY2goZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICB2YXIgb3B0aW9uLCByZXNwb25zZUhhbmRsZXI7XG4gICAgICBpZiAoc3RhdGUudXJsKSB7XG4gICAgICAgIG9wdGlvbiA9IGZpbmRTdGF0ZU9wdGlvbihzdGF0ZS5uYW1lKTtcbiAgICAgICAgcmVzcG9uc2VIYW5kbGVyID0gZ2V0UmVzcG9uc2VIYW5kbGVyKHN0YXRlKTtcbiAgICAgICAgaWYgKHN0YXRlLmFjdGl2ZSkge1xuICAgICAgICAgIHJlc3BvbnNlSGFuZGxlci5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRodHRwQmFja2VuZC5zZXREZWxheShvcHRpb24uZGVsYXkpO1xuICAgICAgICAgICAgcmV0dXJuIFtvcHRpb24uc3RhdHVzLCBhbmd1bGFyLmlzRnVuY3Rpb24ob3B0aW9uLmRhdGEpID8gb3B0aW9uLmRhdGEoKSA6IG9wdGlvbi5kYXRhXTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNwb25zZUhhbmRsZXIucGFzc1Rocm91Z2goKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0UmVzcG9uc2VIYW5kbGVyKHN0YXRlKSB7XG4gICAgaWYgKCFyZXNwb25zZUhhbmRsZXJzW3N0YXRlLm5hbWVdKSB7XG4gICAgICByZXNwb25zZUhhbmRsZXJzW3N0YXRlLm5hbWVdID0gJGh0dHBCYWNrZW5kLndoZW4oc3RhdGUudmVyYiB8fCAnR0VUJywgbmV3IFJlZ0V4cChzdGF0ZS51cmwpKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3BvbnNlSGFuZGxlcnNbc3RhdGUubmFtZV07XG4gIH1cblxuICByZXR1cm4ge1xuICAgIC8vY29uZmlndXJlZCBzdGF0ZXMgdG9kbyBkb2NcbiAgICBzdGF0ZXM6IHN0YXRlcyxcbiAgICAvL3RvZG8gZG9jXG4gICAgYWN0aXZlX3N0YXRlc19vcHRpb246IFtdLFxuICAgIC8vdG9kbyBkb2NcbiAgICB1cHNlcnRPcHRpb246IHVwc2VydE9wdGlvbixcbiAgICAvL3RvZG8gZG9jXG4gICAgZmV0Y2hTdGF0ZXM6IGZldGNoU3RhdGVzLFxuICAgIGdldFN0YXRlOiBmdW5jdGlvbihuYW1lKXtcbiAgICAgIHZhciBzdGF0ZSA9IGZldGNoU3RhdGVzKCkuZmluZChzdGF0ZSA9PiBzdGF0ZS5uYW1lID09PSBuYW1lKTtcbiAgICAgIHJldHVybiAoc3RhdGUgJiYgc3RhdGUuYWN0aXZlICYmIGZpbmRTdGF0ZU9wdGlvbihuYW1lKSkgfHwgbnVsbDtcbiAgICB9LFxuICAgIGFkZFN0YXRlOiBmdW5jdGlvbihzdGF0ZU9iaikge1xuICAgICAgc3RhdGVPYmoub3B0aW9ucy5mb3JFYWNoKChvcHRpb24pID0+IHtcbiAgICAgICAgdGhpcy51cHNlcnQoe1xuICAgICAgICAgIHN0YXRlOiBzdGF0ZU9iai5uYW1lLFxuICAgICAgICAgIHVybDogc3RhdGVPYmoudXJsLFxuICAgICAgICAgIHZlcmI6IG9wdGlvbi52ZXJiLFxuICAgICAgICAgIG5hbWU6IG9wdGlvbi5uYW1lLFxuICAgICAgICAgIHN0YXR1czogb3B0aW9uLnN0YXR1cyxcbiAgICAgICAgICBkYXRhOiBvcHRpb24uZGF0YSxcbiAgICAgICAgICBkZWxheTogb3B0aW9uLmRlbGF5XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBhZGRTdGF0ZXM6IGZ1bmN0aW9uKHN0YXRlc0Fycikge1xuICAgICAgc3RhdGVzQXJyLmZvckVhY2goKHN0YXRlT2JqKSA9PiB7XG4gICAgICAgIHRoaXMuYWRkU3RhdGUoc3RhdGVPYmopO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICAvL2luc2VydCBvciByZXBsYWNlIGFuIG9wdGlvbiBieSBpbnNlcnQgb3IgdXBkYXRlaW5nIGEgc3RhdGUuXG4gICAgdXBzZXJ0OiBmdW5jdGlvbih7IHZlcmIsIHN0YXRlLCBuYW1lLCB1cmwsIHN0YXR1cyA9IDIwMCwgZGF0YSA9IHt9LCBkZWxheSA9IDB9KXtcbiAgICAgIHZhciBkZWZhdWx0U3RhdGUgPSB7fTtcblxuICAgICAgdmFyIGRlZmF1bHRPcHRpb24gPSB7fTtcblxuICAgICAgaWYgKCFzdGF0ZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhcImNhbm5vdCB1cHNlcnQgLSBzdGF0ZSBpcyBtYW5kYXRvcnlcIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdmFyIHN0YXRlSXRlbSA9IHN0YXRlcy5maW5kKF9zdGF0ZSA9PiBfc3RhdGUubmFtZSA9PT0gc3RhdGUpIHx8IGRlZmF1bHRTdGF0ZTtcblxuICAgICAgYW5ndWxhci5leHRlbmQoc3RhdGVJdGVtLCB7XG4gICAgICAgIG5hbWU6IHN0YXRlLFxuICAgICAgICB1cmw6IHVybCB8fCBzdGF0ZUl0ZW0udXJsLFxuICAgICAgICB2ZXJiOiB2ZXJiIHx8IHN0YXRlSXRlbS52ZXJiLFxuICAgICAgICBvcHRpb25zOiBzdGF0ZUl0ZW0ub3B0aW9ucyB8fCBbXVxuICAgICAgfSk7XG5cblxuICAgICAgaWYgKHN0YXRlSXRlbSA9PT0gZGVmYXVsdFN0YXRlKSB7XG4gICAgICAgIHN0YXRlcy5wdXNoKHN0YXRlSXRlbSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBvcHRpb24gPSBzdGF0ZUl0ZW0ub3B0aW9ucy5maW5kKF9vcHRpb24gPT4gX29wdGlvbi5uYW1lID09PSBuYW1lKSB8fCBkZWZhdWx0T3B0aW9uO1xuXG4gICAgICBhbmd1bGFyLmV4dGVuZChvcHRpb24sIHtcbiAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgc3RhdHVzOiBzdGF0dXMsXG4gICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgIGRlbGF5OiBkZWxheVxuICAgICAgfSk7XG5cbiAgICAgIGlmIChvcHRpb24gPT09IGRlZmF1bHRPcHRpb24pIHtcbiAgICAgICAgc3RhdGVJdGVtLm9wdGlvbnMucHVzaChvcHRpb24pO1xuICAgICAgfVxuICAgICAgc3luYygpO1xuICAgIH0sXG4gICAgLy90b2RvIGRvY1xuICAgIHVwc2VydE1hbnk6IGZ1bmN0aW9uKGl0ZW1zKXtcbiAgICAgIGl0ZW1zLmZvckVhY2goaXRlbSA9PiB0aGlzLnVwc2VydChpdGVtKSk7XG4gICAgfSxcbiAgICBkZWFjdGl2YXRlQWxsOiBkZWFjdGl2YXRlQWxsXG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNvbmZpZ3VyYXRpb25TZXJ2aWNlOyIsImZ1bmN0aW9uIHN0b3JhZ2VTZXJ2aWNlKCkge1xuICB2YXIgU1RBVEVTX1NUT1JFX0tFWSA9ICdzdGF0ZXMnO1xuICBmdW5jdGlvbiBnZXRJdGVtKGtleSkge1xuICAgIHZhciBpdGVtID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcbiAgICBpZiAoIWl0ZW0pIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gYW5ndWxhci5mcm9tSnNvbihpdGVtKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldEl0ZW0oa2V5LCBkYXRhKSB7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCBhbmd1bGFyLnRvSnNvbihkYXRhKSk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRTdGF0ZXMoKSB7XG4gICAgcmV0dXJuIGdldEl0ZW0oU1RBVEVTX1NUT1JFX0tFWSkgfHwge307XG4gIH1cblxuICBmdW5jdGlvbiBzZXRTdGF0ZXMoc3RhdGVzKSB7XG4gICAgc2V0SXRlbShTVEFURVNfU1RPUkVfS0VZLCBzdGF0ZXMpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRJdGVtOiBnZXRJdGVtLFxuICAgIHNldEl0ZW06IHNldEl0ZW0sXG4gICAgc2V0U3RhdGVzOiBzZXRTdGF0ZXMsXG4gICAgZ2V0U3RhdGVzOiBnZXRTdGF0ZXNcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgc3RvcmFnZVNlcnZpY2U7IiwiLy8gVGhpcyBJcyBBIEhlYWRlclxuLy8gLS0tLS0tLS0tLS0tLS0tLVxuXG5cbi8vIFRoaXMgaXMgYSBub3JtYWwgY29tbWVudCwgdGhhdCB3aWxsIGJlY29tZSBwYXJ0IG9mIHRoZVxuLy8gYW5ub3RhdGlvbnMgYWZ0ZXIgcnVubmluZyB0aHJvdWdoIHRoZSBEb2NjbyB0b29sLiBVc2UgdGhpc1xuLy8gc3BhY2UgdG8gZGVzY3JpYmUgdGhlIGZ1bmN0aW9uIG9yIG90aGVyIGNvZGUganVzdCBiZWxvd1xuLy8gdGhpcyBjb21tZW50LiBGb3IgZXhhbXBsZTpcbi8vXG4vLyBUaGUgYERvU29tZXRoaW5nYCBtZXRob2QgZG9lcyBzb21ldGhpbmchIEl0IGRvZXNuJ3QgdGFrZSBhbnlcbi8vIHBhcmFtZXRlcnMuLi4gaXQganVzdCBkb2VzIHNvbWV0aGluZy5cbmZ1bmN0aW9uIHdpbmRvd0JvZHlEaXJlY3RpdmUoJGh0dHAsIGNvbmZpZ3VyYXRpb24pIHtcbiAgcmV0dXJuIHtcbiAgICByZXN0cmljdDogJ0UnLFxuICAgIHRlbXBsYXRlVXJsOiAnd2luZG93LWJvZHkuaHRtbCcsXG4gICAgc2NvcGU6IHRydWUsXG4gICAgcmVwbGFjZTogdHJ1ZSxcbiAgICBjb250cm9sbGVyOiBmdW5jdGlvbigkc2NvcGUpe1xuICAgICAgJHNjb3BlLnNlbGVjdGVkSXRlbSA9ICdhY3RpdmF0ZSc7XG4gICAgICAkc2NvcGUuTm90aGFzVXJsID0gZnVuY3Rpb24ob3B0aW9uKXtcbiAgICAgICAgcmV0dXJuICFvcHRpb24udXJsO1xuICAgICAgfTtcbiAgICAgICRzY29wZS5oYXNVcmwgPSBmdW5jdGlvbihvcHRpb24pe1xuICAgICAgICByZXR1cm4gISFvcHRpb24udXJsO1xuICAgICAgfTtcblxuICAgICAgJHNjb3BlLmRlYWN0aXZhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgJHNjb3BlLnN0YXRlcy5mb3JFYWNoKGZ1bmN0aW9uKHN0YXRlKXtcbiAgICAgICAgICAgIHN0YXRlLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uZmlndXJhdGlvbi5kZWFjdGl2YXRlQWxsKCk7XG4gICAgICB9O1xuXG4gICAgICAkc2NvcGUudXBkYXRlU3RhdGUgPSBmdW5jdGlvbihzdGF0ZSl7XG4gICAgICAgIGNvbnNvbGUubG9nKGB1cGRhdGUgc3RhdGU6ICR7c3RhdGUubmFtZX0gJHtzdGF0ZS5hY3RpdmVPcHRpb24ubmFtZX0gJHtzdGF0ZS5hY3RpdmV9YCk7XG4gICAgICAgIGNvbmZpZ3VyYXRpb24udXBzZXJ0T3B0aW9uKHN0YXRlLm5hbWUsIHN0YXRlLmFjdGl2ZU9wdGlvbi5uYW1lLCBzdGF0ZS5hY3RpdmUpO1xuICAgICAgfTtcblxuICAgICAgJHNjb3BlLnN0YXRlcyA9IGNvbmZpZ3VyYXRpb24uZmV0Y2hTdGF0ZXMoKTtcbiAgICB9LFxuICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlKSB7XG4gICAgICBzY29wZS50ZXN0ID0ge1xuICAgICAgICB1cmw6ICcnLFxuICAgICAgICB2YWx1ZTogdW5kZWZpbmVkXG4gICAgICB9O1xuXG4gICAgICBzY29wZS5zdWJtaXQgPSBmdW5jdGlvbih1cmwpe1xuICAgICAgICBzY29wZS50ZXN0LnZhbHVlID0gdW5kZWZpbmVkO1xuICAgICAgICBzY29wZS51cmwgPSB1cmw7XG4gICAgICAgIGlmICh1cmwpIHtcbiAgICAgICAgICAkaHR0cC5nZXQodXJsKS5zdWNjZXNzKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIHNjb3BlLnRlc3QudmFsdWUgPSByZXM7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCB3aW5kb3dCb2R5RGlyZWN0aXZlIiwiaW1wb3J0IGFjdGl2YXRvckRpcmVjdGl2ZSBmcm9tICcuL2FjdGl2YXRvci5kcnYuanMnO1xuaW1wb3J0IGNvbmZpZ3VyYXRpb25TZXJ2aWNlIGZyb20gJy4vY29uZmlndXJhdGlvbi5zcnYuanMnO1xuaW1wb3J0IHN0b3JhZ2VTZXJ2aWNlIGZyb20gJy4vc3RvcmFnZS5zcnYuanMnO1xuaW1wb3J0IHdpbmRvd0JvZHlEaXJlY3RpdmUgZnJvbSAnLi93aW5kb3ctYm9keS5kcnYuanMnO1xuXG5leHBvcnQgZGVmYXVsdCBhbmd1bGFyLm1vZHVsZSgnbGVvbmFyZG8nLCBbJ2xlb25hcmRvLnRlbXBsYXRlcycsICduZ01vY2tFMkUnXSlcbiAgLmZhY3RvcnkoJ3N0b3JhZ2UnLCBzdG9yYWdlU2VydmljZSlcbiAgLmZhY3RvcnkoJ2NvbmZpZ3VyYXRpb24nLCBjb25maWd1cmF0aW9uU2VydmljZSlcbiAgLmRpcmVjdGl2ZSgnYWN0aXZhdG9yJywgYWN0aXZhdG9yRGlyZWN0aXZlKVxuICAuZGlyZWN0aXZlKCd3aW5kb3dCb2R5Jywgd2luZG93Qm9keURpcmVjdGl2ZSlcbiAgLyogd3JhcCAkaHR0cGJhY2tlbmQgd2l0aCBhIHByb3h5IGluIG9yZGVyIHRvIHN1cHBvcnQgZGVsYXlpbmcgaXRzIHJlc3BvbnNlc1xuICAgKiB3ZSBhcmUgdXNpbmcgdGhlIGFwcHJvYWNoIGRlc2NyaWJlZCBpbiBFbmRsZXNzIEluZGlyZWN0aW9uOlxuICAgKiBodHRwczovL2VuZGxlc3NpbmRpcmVjdGlvbi53b3JkcHJlc3MuY29tLzIwMTMvMDUvMTgvYW5ndWxhcmpzLWRlbGF5LXJlc3BvbnNlLWZyb20taHR0cGJhY2tlbmQvXG4gICAqL1xuICAuY29uZmlnKGZ1bmN0aW9uKCRwcm92aWRlKSB7XG4gICAgJHByb3ZpZGUuZGVjb3JhdG9yKCckaHR0cEJhY2tlbmQnLCBmdW5jdGlvbigkZGVsZWdhdGUpIHtcbiAgICAgIHZhciBwcm94eSA9IGZ1bmN0aW9uKG1ldGhvZCwgdXJsLCBkYXRhLCBjYWxsYmFjaywgaGVhZGVycykge1xuICAgICAgICB2YXIgaW50ZXJjZXB0b3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzLFxuICAgICAgICAgICAgICBfYXJndW1lbnRzID0gYXJndW1lbnRzO1xuICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjYWxsYmFjay5hcHBseShfdGhpcywgX2FyZ3VtZW50cyk7XG4gICAgICAgICAgfSwgcHJveHkuZGVsYXkgfHwgMCk7XG4gICAgICAgICAgcHJveHkuZGVsYXkgPSAwO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gJGRlbGVnYXRlLmNhbGwodGhpcywgbWV0aG9kLCB1cmwsIGRhdGEsIGludGVyY2VwdG9yLCBoZWFkZXJzKTtcbiAgICAgIH07XG4gICAgICBmb3IodmFyIGtleSBpbiAkZGVsZWdhdGUpIHtcbiAgICAgICAgcHJveHlba2V5XSA9ICRkZWxlZ2F0ZVtrZXldO1xuICAgICAgfVxuICAgICAgcHJveHkuc2V0RGVsYXkgPSAoZGVsYXkpID0+IHtcbiAgICAgICAgcHJveHkuZGVsYXkgPSBkZWxheTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gcHJveHk7XG4gICAgfSk7XG4gIH0pO1xuXG4iXX0=

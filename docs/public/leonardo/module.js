$traceurRuntime.options.symbols = true;
System.registerModule("../src/leonardo/activator.drv.js", [], function() {
  "use strict";
  var __moduleName = "../src/leonardo/activator.drv.js";
  function activatorDirective($compile) {
    return {
      restrict: 'A',
      link: function(scope, elem) {
        var el = angular.element('<div ng-click="activate()" class="leonardo-activator"></div>');
        var win = angular.element(['<div class="leonardo-window">', '<div class="leonardo-header">Leonardo Configuration</div>', '<window-body></window-body>', '</div>', '</div>'].join(''));
        $compile(el)(scope);
        $compile(win)(scope);
        elem.append(el);
        elem.append(win);
        win[0].addEventListener('webkitTransitionEnd', function() {
          if (!document.body.classList.contains('pull-top')) {
            document.body.classList.add("pull-top-closed");
          }
        }, false);
        scope.activate = function() {
          if (!document.body.classList.contains('pull-top')) {
            document.body.classList.add('pull-top');
            document.body.classList.remove('pull-top-closed');
          } else {
            document.body.classList.remove('pull-top');
          }
        };
      }
    };
  }
  var $__default = activatorDirective;
  return {get default() {
    return $__default;
  }};
});
$traceurRuntime.options.symbols = true;
System.registerModule("../src/leonardo/configuration.srv.js", [], function() {
  "use strict";
  var __moduleName = "../src/leonardo/configuration.srv.js";
  function configurationService($q, activeStatesStore, $httpBackend) {
    var states = [];
    var stateReq = {};
    var upsertOption = function(state, name, active) {
      var states = getStatesFromStore();
      states[$traceurRuntime.toProperty(state)] = {
        name: name,
        active: active
      };
      activeStatesStore.set('states', states);
      return sync();
    };
    function getStatesFromStore() {
      return activeStatesStore.get('states') || {};
    }
    function fetchStates() {
      var activeStates = getStatesFromStore();
      var _states = states.map((function(state) {
        return angular.copy(state);
      }));
      _states.forEach(function(state) {
        var option = activeStates[$traceurRuntime.toProperty(state.name)];
        state.active = !!option && option.active;
        state.activeOption = !!option ? state.options.find((function(_option) {
          return _option.name === option.name;
        })) : state.options[0];
      });
      return $q.when(_states);
    }
    function deactivateAll() {
      var storedStates = getStatesFromStore();
      Object.keys(storedStates).forEach(function(stateKey) {
        storedStates[$traceurRuntime.toProperty(stateKey)].active = false;
      });
      activeStatesStore.set('states', storedStates);
    }
    function findStateOption(name) {
      return fetchStates().then(function(states) {
        return states.find((function(state) {
          return state.name === name;
        })).activeOption;
      });
    }
    function sync() {
      return fetchStates().then(function(states) {
        var defer = $q.defer();
        var promise = defer.promise;
        defer.resolve();
        states.forEach(function(state) {
          promise = promise.then(function() {
            return findStateOption(state.name).then(function(option) {
              if (state.active) {
                stateReq[$traceurRuntime.toProperty(state.name)].respond(function() {
                  return [option.status, option.data];
                });
              } else {
                stateReq[$traceurRuntime.toProperty(state.name)].passThrough();
              }
            });
          });
        });
        return promise;
      });
    }
    var initialized = fetchStates().then(function() {
      (states || []).forEach(function(state) {
        stateReq[$traceurRuntime.toProperty(state.name)] = $httpBackend.when(state.verb || 'GET', new RegExp(state.url));
      });
    });
    return {
      states: states,
      initialize: function() {
        return initialized.then(sync);
      },
      active_states_option: [],
      upsertOption: upsertOption,
      fetchStates: fetchStates,
      getState: function(name) {
        return fetchStates().then(function(states) {
          var state = states.find((function(state) {
            return state.name === name;
          }));
          return (state && state.active && findStateOption(name)) || $q.when(null);
        });
      },
      upsert: function($__1) {
        var $__3,
            $__4,
            $__5;
        var $__2 = $__1,
            verb = $__2.verb,
            state = $__2.state,
            name = $__2.name,
            url = $__2.url,
            status = ($__3 = $__2.status) === void 0 ? 200 : $__3,
            data = ($__4 = $__2.data) === void 0 ? {} : $__4,
            delay = ($__5 = $__2.delay) === void 0 ? 0 : $__5;
        var defaultState = {};
        var defaultOption = {};
        if (!state) {
          console.log("cannot upsert - state is mandatory");
          return ;
        }
        var stateItem = states.find((function(_state) {
              return _state.name === state;
            })) || defaultState;
        console.log("");
        angular.extend(stateItem, {
          name: state,
          url: url || stateItem.url,
          verb: verb || stateItem.verb,
          options: stateItem.options || []
        });
        if (stateItem === defaultState) {
          states.push(stateItem);
        }
        var option = stateItem.options.find((function(_option) {
              return _option.name === name;
            })) || defaultOption;
        angular.extend(option, {
          name: name,
          status: status,
          data: data,
          delay: delay
        });
        if (option === defaultOption) {
          stateItem.options.push(option);
        }
      },
      upsertMany: function(items) {
        var $__0 = this;
        items.forEach((function(item) {
          return $__0.upsert(item);
        }));
      },
      deactivateAll: deactivateAll
    };
  }
  var $__default = configurationService;
  return {get default() {
    return $__default;
  }};
});
$traceurRuntime.options.symbols = true;
System.registerModule("../src/leonardo/window-body.drv.js", [], function() {
  "use strict";
  var __moduleName = "../src/leonardo/window-body.drv.js";
  function windowBodyDirective($http, configuration) {
    return {
      restrict: 'E',
      templateUrl: 'window-body.html',
      scope: true,
      replace: true,
      controller: function($scope) {
        $scope.selectedItem = 'activate';
        $scope.NothasUrl = function(option) {
          return !option.url;
        };
        $scope.hasUrl = function(option) {
          return !!option.url;
        };
        $scope.deactivate = function() {
          $scope.states.forEach(function(state) {
            state.active = false;
          });
          configuration.deactivateAll();
        };
        configuration.fetchStates().then(function(states) {
          $scope.states = states;
          $scope.changeActive = function(state) {
            console.log("activate: " + state.name + " " + state.active);
            configuration.upsertOption(state.name, state.activeOption.name, state.active);
          };
          states.forEach(function(state) {
            $scope.$watch(function() {
              return state.activeOption;
            }, function(activeOption, oldValue) {
              if (activeOption !== oldValue) {
                console.log("select: " + state.name + " " + activeOption.name + " " + state.active);
                configuration.upsertOption(state.name, activeOption.name, state.active);
              }
            });
          });
        });
      },
      link: function(scope) {
        scope.test = {
          url: '',
          value: undefined
        };
        scope.submit = function(url) {
          scope.test.value = undefined;
          scope.url = url;
          if (url) {
            $http.get(url).success(function(res) {
              scope.test.value = res;
            });
          }
        };
      }
    };
  }
  var $__default = windowBodyDirective;
  return {get default() {
    return $__default;
  }};
});
$traceurRuntime.options.symbols = true;
System.registerModule("../src/leonardo/module.js", [], function() {
  "use strict";
  var __moduleName = "../src/leonardo/module.js";
  var activatorDirective = System.get("../src/leonardo/activator.drv.js").default;
  var configurationService = System.get("../src/leonardo/configuration.srv.js").default;
  var windowBodyDirective = System.get("../src/leonardo/window-body.drv.js").default;
  var $__default = angular.module('leonardo', ['leonardo.templates', 'angular-storage', 'ngMockE2E']).factory('configuration', configurationService).factory('activeStatesStore', function(store) {
    return store.getNamespacedStore('active_states');
  }).directive('activator', activatorDirective).directive('windowBody', windowBodyDirective);
  return {get default() {
    return $__default;
  }};
});
System.get("../src/leonardo/module.js" + '');
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9sZW9uYXJkby9hY3RpdmF0b3IuZHJ2LmpzIiwiLi4vc3JjL2xlb25hcmRvL2NvbmZpZ3VyYXRpb24uc3J2LmpzIiwiLi4vc3JjL2xlb25hcmRvL3dpbmRvdy1ib2R5LmRydi5qcyIsIi4uL3NyYy9sZW9uYXJkby9tb2R1bGUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkEsYyxRLFEsRSxLLEM7QSxLLGUsQSxvQyxHLEMsVSxBOztBLEEsSSxDLFkscUMsQztBQUFBLFNBQVMsbUJBQWlCLENBQUUsUUFBTztBQUNqQyxTQUFPO0FBQ0wsYUFBTyxDQUFHLElBQUU7QUFDWixTQUFHLENBQUcsVUFBUyxLQUFJLENBQUcsQ0FBQSxJQUFHO0FBQ3ZCLEFBQUksVUFBQSxDQUFBLEVBQUMsRUFBSSxDQUFBLE9BQU0sUUFBUSxBQUFDLENBQUMsOERBQTZELENBQUMsQ0FBQztBQUV4RixBQUFJLFVBQUEsQ0FBQSxHQUFFLEVBQUksQ0FBQSxPQUFNLFFBQVEsQUFBQyxDQUFDLENBQzFCLCtCQUE4QixDQUM1Qiw0REFBMEQsQ0FDeEQsOEJBQTRCLENBQzlCLFNBQU8sQ0FDVCxTQUFPLENBQ1AsS0FBSyxBQUFDLENBQUMsRUFBQyxDQUFDLENBQUMsQ0FBQztBQUVYLGVBQU8sQUFBQyxDQUFDLEVBQUMsQ0FBQyxBQUFDLENBQUMsS0FBSSxDQUFDLENBQUM7QUFDbkIsZUFBTyxBQUFDLENBQUMsR0FBRSxDQUFDLEFBQUMsQ0FBQyxLQUFJLENBQUMsQ0FBQztBQUVwQixXQUFHLE9BQU8sQUFBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO0FBQ2YsV0FBRyxPQUFPLEFBQUMsQ0FBQyxHQUFFLENBQUMsQ0FBQztBQUVoQixVQUFFLENBQUUsQ0FBQSxDQUFDLGlCQUFpQixBQUFDLENBQUUscUJBQW9CLENBQUcsVUFBUyxBQUFELENBQUc7QUFDekQsYUFBSSxDQUFDLFFBQU8sS0FBSyxVQUFVLFNBQVMsQUFBQyxDQUFDLFVBQVMsQ0FBQyxDQUFFO0FBQ2hELG1CQUFPLEtBQUssVUFBVSxJQUFJLEFBQUMsQ0FBQyxpQkFBZ0IsQ0FBQyxDQUFDO1VBQ2hEO0FBQUEsUUFDRixDQUFHLE1BQUksQ0FBRSxDQUFDO0FBRVYsWUFBSSxTQUFTLEVBQUksVUFBUyxBQUFELENBQUU7QUFDekIsYUFBSSxDQUFDLFFBQU8sS0FBSyxVQUFVLFNBQVMsQUFBQyxDQUFDLFVBQVMsQ0FBQyxDQUFHO0FBQ2pELG1CQUFPLEtBQUssVUFBVSxJQUFJLEFBQUMsQ0FBQyxVQUFTLENBQUMsQ0FBQztBQUN2QyxtQkFBTyxLQUFLLFVBQVUsT0FBTyxBQUFDLENBQUMsaUJBQWdCLENBQUMsQ0FBQztVQUNuRCxLQUNLO0FBQ0gsbUJBQU8sS0FBSyxVQUFVLE9BQU8sQUFBQyxDQUFDLFVBQVMsQ0FBQyxDQUFDO1VBQzVDO0FBQUEsUUFDRixDQUFDO01BQ0g7QUFBQSxJQUNGLENBQUM7RUFDSDtBQXJDQSxBQUFJLElBQUEsQ0FBQSxVQUFTLEVBdUNFLG1CQUFpQixBQXZDQyxDQUFBO0FBQWpDLFNBQUEsYUFBd0I7QUFBRSx1QkFBd0I7SUFBRSxFQUE3QjtBQUVqQixDQUZ3RCxDQUFDO0FBQS9ELGNBQWMsUUFBUSxRQUFRLEVBQUksS0FBRyxDQUFBO0FBQXJDLEtBQUssZUFBZSxBQUFDLHdDQUFvQixHQUFDLENBQTFDLFVBQVMsQUFBRDs7QUFBUixBQUFJLElBQUEsQ0FBQSxZQUFXLHlDQUFvQixDQUFDO0FDQXBDLFNBQVMscUJBQW1CLENBQUUsRUFBQyxDQUFHLENBQUEsaUJBQWdCLENBQUcsQ0FBQSxZQUFXO0FBQzlELEFBQUksTUFBQSxDQUFBLE1BQUssRUFBSSxHQUFDLENBQUM7QUFDZixBQUFJLE1BQUEsQ0FBQSxRQUFPLEVBQUksR0FBQyxDQUFDO0FBRWpCLEFBQUksTUFBQSxDQUFBLFlBQVcsRUFBSSxVQUFTLEtBQUksQ0FBRyxDQUFBLElBQUcsQ0FBRyxDQUFBLE1BQUs7QUFDNUMsQUFBSSxRQUFBLENBQUEsTUFBSyxFQUFJLENBQUEsa0JBQWlCLEFBQUMsRUFBQyxDQUFDO0FBQ2pDLFdBQUssQ0FOUyxlQUFjLFdBQVcsQUFBQyxDQU1qQyxLQUFJLENBTitDLENBQUMsRUFNM0M7QUFDZCxXQUFHLENBQUcsS0FBRztBQUNULGFBQUssQ0FBRyxPQUFLO0FBQUEsTUFDZixDQUFDO0FBRUQsc0JBQWdCLElBQUksQUFBQyxDQUFDLFFBQU8sQ0FBRyxPQUFLLENBQUMsQ0FBQztBQUV2QyxXQUFPLENBQUEsSUFBRyxBQUFDLEVBQUMsQ0FBQztJQUNmLENBQUM7QUFFRCxXQUFTLG1CQUFpQixDQUFFLEFBQUQsQ0FBRTtBQUMzQixXQUFPLENBQUEsaUJBQWdCLElBQUksQUFBQyxDQUFDLFFBQU8sQ0FBQyxDQUFBLEVBQUssR0FBQyxDQUFDO0lBQzlDO0FBQUEsQUFFQSxXQUFTLFlBQVUsQ0FBRSxBQUFEO0FBQ2xCLEFBQUksUUFBQSxDQUFBLFlBQVcsRUFBSSxDQUFBLGtCQUFpQixBQUFDLEVBQUMsQ0FBQztBQUN2QyxBQUFJLFFBQUEsQ0FBQSxPQUFNLEVBQUksQ0FBQSxNQUFLLElBQUksQUFBQyxFQUFDLFNBQUEsS0FBSTthQUFLLENBQUEsT0FBTSxLQUFLLEFBQUMsQ0FBQyxLQUFJLENBQUM7TUFBQSxFQUFDLENBQUM7QUFFdkQsWUFBTSxRQUFRLEFBQUMsQ0FBQyxTQUFTLEtBQUk7QUFDMUIsQUFBSSxVQUFBLENBQUEsTUFBSyxFQXpCZixDQXlCbUIsWUFBVyxDQXpCWixlQUFjLFdBQVcsQUFBQyxDQXlCWixLQUFJLEtBQUssQ0F6QnFCLENBQUMsQUF5QnJCLENBQUM7QUFDckMsWUFBSSxPQUFPLEVBQUksQ0FBQSxDQUFDLENBQUMsTUFBSyxDQUFBLEVBQUssQ0FBQSxNQUFLLE9BQU8sQ0FBQztBQUN4QyxZQUFJLGFBQWEsRUFBSSxDQUFBLENBQUMsQ0FBQyxNQUFLLENBQUEsQ0FBSSxDQUFBLEtBQUksUUFBUSxLQUFLLEFBQUMsRUFBQyxTQUFBLE9BQU07ZUFBSyxDQUFBLE9BQU0sS0FBSyxJQUFNLENBQUEsTUFBSyxLQUFLO1FBQUEsRUFBQyxDQUFBLENBQUksQ0FBQSxLQUFJLFFBQVEsQ0FBRSxDQUFBLENBQUMsQ0FBQztNQUNoSCxDQUFDLENBQUM7QUFFRixXQUFPLENBQUEsRUFBQyxLQUFLLEFBQUMsQ0FBQyxPQUFNLENBQUMsQ0FBQztJQUN6QjtBQUVBLFdBQVMsY0FBWSxDQUFFLEFBQUQ7QUFDcEIsQUFBSSxRQUFBLENBQUEsWUFBVyxFQUFJLENBQUEsa0JBQWlCLEFBQUMsRUFBQyxDQUFDO0FBQ3ZDLFdBQUssS0FBSyxBQUFDLENBQUMsWUFBVyxDQUFDLFFBQVEsQUFBQyxDQUFDLFNBQVMsUUFBTztBQUNoRCxtQkFBVyxDQXBDQyxlQUFjLFdBQVcsQUFBQyxDQW9DekIsUUFBTyxDQXBDb0MsQ0FBQyxPQW9DN0IsRUFBSSxNQUFJLENBQUM7TUFDdkMsQ0FBQyxDQUFDO0FBQ0Ysc0JBQWdCLElBQUksQUFBQyxDQUFDLFFBQU8sQ0FBRyxhQUFXLENBQUMsQ0FBQztJQUMvQztBQUVBLFdBQVMsZ0JBQWMsQ0FBRSxJQUFHO0FBQzFCLFdBQU8sQ0FBQSxXQUFVLEFBQUMsRUFBQyxLQUFLLEFBQUMsQ0FBQyxTQUFTLE1BQUs7QUFDdEMsYUFBTyxDQUFBLE1BQUssS0FBSyxBQUFDLEVBQUMsU0FBQSxLQUFJO2VBQUssQ0FBQSxLQUFJLEtBQUssSUFBTSxLQUFHO1FBQUEsRUFBQyxhQUFhLENBQUM7TUFDL0QsQ0FBQyxDQUFDO0lBRUo7QUFFQSxXQUFTLEtBQUcsQ0FBRSxBQUFEO0FBQ1gsV0FBTyxDQUFBLFdBQVUsQUFBQyxFQUFDLEtBQUssQUFBQyxDQUFDLFNBQVMsTUFBSztBQUN0QyxBQUFJLFVBQUEsQ0FBQSxLQUFJLEVBQUksQ0FBQSxFQUFDLE1BQU0sQUFBQyxFQUFDLENBQUM7QUFDdEIsQUFBSSxVQUFBLENBQUEsT0FBTSxFQUFJLENBQUEsS0FBSSxRQUFRLENBQUM7QUFDM0IsWUFBSSxRQUFRLEFBQUMsRUFBQyxDQUFDO0FBQ2YsYUFBSyxRQUFRLEFBQUMsQ0FBQyxTQUFVLEtBQUk7QUFDM0IsZ0JBQU0sRUFBSSxDQUFBLE9BQU0sS0FBSyxBQUFDLENBQUMsU0FBUyxBQUFEO0FBQzdCLGlCQUFPLENBQUEsZUFBYyxBQUFDLENBQUMsS0FBSSxLQUFLLENBQUMsS0FBSyxBQUFDLENBQUMsU0FBUyxNQUFLO0FBQ3BELGlCQUFJLEtBQUksT0FBTyxDQUNmO0FBQ0UsdUJBQU8sQ0ExREgsZUFBYyxXQUFXLEFBQUMsQ0EwRHJCLEtBQUksS0FBSyxDQTFEOEIsQ0FBQyxRQTBEdEIsQUFBQyxDQUFDLFNBQVUsQUFBRCxDQUFHO0FBS3ZDLHVCQUFPLEVBQUMsTUFBSyxPQUFPLENBQUcsQ0FBQSxNQUFLLEtBQUssQ0FBQyxDQUFDO2dCQUNyQyxDQUFDLENBQUM7Y0FDSixLQUNLO0FBQ0gsdUJBQU8sQ0FuRUgsZUFBYyxXQUFXLEFBQUMsQ0FtRXJCLEtBQUksS0FBSyxDQW5FOEIsQ0FBQyxZQW1FbEIsQUFBQyxFQUFDLENBQUM7Y0FDcEM7QUFBQSxZQUNGLENBQUMsQ0FBQztVQUNKLENBQUMsQ0FBQztRQUNKLENBQUMsQ0FBQztBQUVGLGFBQU8sUUFBTSxDQUFDO01BQ2hCLENBQUMsQ0FBQztJQUNKO0FBRUEsQUFBSSxNQUFBLENBQUEsV0FBVSxFQUFJLENBQUEsV0FBVSxBQUFDLEVBQUMsS0FBSyxBQUFDLENBQUMsU0FBUyxBQUFEO0FBQzNDLE1BQUMsTUFBSyxHQUFLLEdBQUMsQ0FBQyxRQUFRLEFBQUMsQ0FBQyxTQUFVLEtBQUk7QUFDbkMsZUFBTyxDQS9FSyxlQUFjLFdBQVcsQUFBQyxDQStFN0IsS0FBSSxLQUFLLENBL0VzQyxDQUFDLEVBK0VsQyxDQUFBLFlBQVcsS0FBSyxBQUFDLENBQUMsS0FBSSxLQUFLLEdBQUssTUFBSSxDQUFHLElBQUksT0FBSyxBQUFDLENBQUMsS0FBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO01BQ3RGLENBQUMsQ0FBQztJQUNKLENBQUMsQ0FBQztBQUVGLFNBQU87QUFFTCxXQUFLLENBQUcsT0FBSztBQUNiLGVBQVMsQ0FBRyxVQUFTLEFBQUQsQ0FBRTtBQUNwQixhQUFPLENBQUEsV0FBVSxLQUFLLEFBQUMsQ0FBQyxJQUFHLENBQUMsQ0FBQztNQUMvQjtBQUVBLHlCQUFtQixDQUFHLEdBQUM7QUFFdkIsaUJBQVcsQ0FBRyxhQUFXO0FBRXpCLGdCQUFVLENBQUcsWUFBVTtBQUN2QixhQUFPLENBQUcsVUFBUyxJQUFHO0FBQ3BCLGFBQU8sQ0FBQSxXQUFVLEFBQUMsRUFBQyxLQUFLLEFBQUMsQ0FBQyxTQUFTLE1BQUs7QUFDdEMsQUFBSSxZQUFBLENBQUEsS0FBSSxFQUFJLENBQUEsTUFBSyxLQUFLLEFBQUMsRUFBQyxTQUFBLEtBQUk7aUJBQUssQ0FBQSxLQUFJLEtBQUssSUFBTSxLQUFHO1VBQUEsRUFBQyxDQUFDO0FBQ3JELGVBQU8sQ0FBQSxDQUFDLEtBQUksR0FBSyxDQUFBLEtBQUksT0FBTyxDQUFBLEVBQUssQ0FBQSxlQUFjLEFBQUMsQ0FBQyxJQUFHLENBQUMsQ0FBQyxHQUFLLENBQUEsRUFBQyxLQUFLLEFBQUMsQ0FBQyxJQUFHLENBQUMsQ0FBQztRQUMxRSxDQUFDLENBQUM7TUFDSjtBQUVBLFdBQUssQ0FBRyxVQUFTLElBQTREOzs7OztBQUExRCxlQUFHO0FBQUcsZ0JBQUk7QUFBRyxlQUFHO0FBQUcsY0FBRTtBQUFHLGlCQUFLLEVBdEdwRCxDQUFBLENBQUMsa0JBQXNELENBQUMsSUFBTSxLQUFLLEVBQUEsQ0FBQSxDQXNHWCxJQUFFLE9BckdkO0FBcUdpQixlQUFHLEVBdEdoRSxDQUFBLENBQUMsZ0JBQXNELENBQUMsSUFBTSxLQUFLLEVBQUEsQ0FBQSxDQXNHQyxHQUFDLE9Bckd6QjtBQXFHNEIsZ0JBQUksRUF0RzVFLENBQUEsQ0FBQyxpQkFBc0QsQ0FBQyxJQUFNLEtBQUssRUFBQSxDQUFBLENBc0dhLEVBQUEsT0FyR3BDO0FBc0d0QyxBQUFJLFVBQUEsQ0FBQSxZQUFXLEVBQUksR0FBQyxDQUFDO0FBRXJCLEFBQUksVUFBQSxDQUFBLGFBQVksRUFBSSxHQUFDLENBQUM7QUFFdEIsV0FBSSxDQUFDLEtBQUksQ0FBRztBQUNWLGdCQUFNLElBQUksQUFBQyxDQUFDLG9DQUFtQyxDQUFDLENBQUM7QUFDakQsaUJBQU07UUFDUjtBQUFBLEFBRUksVUFBQSxDQUFBLFNBQVEsRUFBSSxDQUFBLE1BQUssS0FBSyxBQUFDLEVBQUMsU0FBQSxNQUFLO2VBQUssQ0FBQSxNQUFLLEtBQUssSUFBTSxNQUFJO1FBQUEsRUFBQyxDQUFBLEVBQUssYUFBVyxDQUFDO0FBRzVFLGNBQU0sSUFBSSxBQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7QUFFZixjQUFNLE9BQU8sQUFBQyxDQUFDLFNBQVEsQ0FBRztBQUN4QixhQUFHLENBQUcsTUFBSTtBQUNWLFlBQUUsQ0FBRyxDQUFBLEdBQUUsR0FBSyxDQUFBLFNBQVEsSUFBSTtBQUN4QixhQUFHLENBQUcsQ0FBQSxJQUFHLEdBQUssQ0FBQSxTQUFRLEtBQUs7QUFDM0IsZ0JBQU0sQ0FBRyxDQUFBLFNBQVEsUUFBUSxHQUFLLEdBQUM7QUFBQSxRQUNqQyxDQUFDLENBQUM7QUFHRixXQUFJLFNBQVEsSUFBTSxhQUFXLENBQUc7QUFDOUIsZUFBSyxLQUFLLEFBQUMsQ0FBQyxTQUFRLENBQUMsQ0FBQztRQUN4QjtBQUFBLEFBRUksVUFBQSxDQUFBLE1BQUssRUFBSSxDQUFBLFNBQVEsUUFBUSxLQUFLLEFBQUMsRUFBQyxTQUFBLE9BQU07ZUFBSyxDQUFBLE9BQU0sS0FBSyxJQUFNLEtBQUc7UUFBQSxFQUFDLENBQUEsRUFBSyxjQUFZLENBQUM7QUFFdEYsY0FBTSxPQUFPLEFBQUMsQ0FBQyxNQUFLLENBQUc7QUFDckIsYUFBRyxDQUFHLEtBQUc7QUFDVCxlQUFLLENBQUcsT0FBSztBQUNiLGFBQUcsQ0FBRyxLQUFHO0FBQ1QsY0FBSSxDQUFHLE1BQUk7QUFBQSxRQUNiLENBQUMsQ0FBQztBQUVGLFdBQUksTUFBSyxJQUFNLGNBQVksQ0FBRztBQUM1QixrQkFBUSxRQUFRLEtBQUssQUFBQyxDQUFDLE1BQUssQ0FBQyxDQUFDO1FBQ2hDO0FBQUEsTUFDRjtBQUVBLGVBQVMsQ0FBRyxVQUFTLEtBQUk7O0FBQ3ZCLFlBQUksUUFBUSxBQUFDLEVBQUMsU0FBQSxJQUFHO2VBQUssQ0FBQSxXQUFVLEFBQUMsQ0FBQyxJQUFHLENBQUM7UUFBQSxFQUFDLENBQUM7TUFDMUM7QUFDQSxrQkFBWSxDQUFHLGNBQVk7QUFBQSxJQUM3QixDQUFDO0VBQ0g7QUFwSkEsQUFBSSxJQUFBLENBQUEsVUFBUyxFQXNKRSxxQkFBbUIsQUF0SkQsQ0FBQTtBQUFqQyxTQUFBLGFBQXdCO0FBQUUsdUJBQXdCO0lBQUUsRUFBN0I7QUFFakIsQ0FGd0QsQ0FBQztBQUEvRCxjQUFjLFFBQVEsUUFBUSxFQUFJLEtBQUcsQ0FBQTtBQUFyQyxLQUFLLGVBQWUsQUFBQyxzQ0FBb0IsR0FBQyxDQUExQyxVQUFTLEFBQUQ7O0FBQVIsQUFBSSxJQUFBLENBQUEsWUFBVyx1Q0FBb0IsQ0FBQztBQ1dwQyxTQUFTLG9CQUFrQixDQUFFLEtBQUksQ0FBRyxDQUFBLGFBQVksQ0FBRztBQUNqRCxTQUFPO0FBQ0wsYUFBTyxDQUFHLElBQUU7QUFDWixnQkFBVSxDQUFHLG1CQUFpQjtBQUM5QixVQUFJLENBQUcsS0FBRztBQUNWLFlBQU0sQ0FBRyxLQUFHO0FBQ1osZUFBUyxDQUFHLFVBQVMsTUFBSyxDQUFFO0FBQzFCLGFBQUssYUFBYSxFQUFJLFdBQVMsQ0FBQztBQUNoQyxhQUFLLFVBQVUsRUFBSSxVQUFTLE1BQUssQ0FBRTtBQUNqQyxlQUFPLEVBQUMsTUFBSyxJQUFJLENBQUM7UUFDcEIsQ0FBQztBQUNELGFBQUssT0FBTyxFQUFJLFVBQVMsTUFBSyxDQUFFO0FBQzlCLGVBQU8sRUFBQyxDQUFDLE1BQUssSUFBSSxDQUFDO1FBQ3JCLENBQUM7QUFFRCxhQUFLLFdBQVcsRUFBSSxVQUFTLEFBQUQsQ0FBRztBQUM3QixlQUFLLE9BQU8sUUFBUSxBQUFDLENBQUMsU0FBUyxLQUFJLENBQUU7QUFDakMsZ0JBQUksT0FBTyxFQUFJLE1BQUksQ0FBQztVQUV4QixDQUFDLENBQUM7QUFDRixzQkFBWSxjQUFjLEFBQUMsRUFBQyxDQUFDO1FBQy9CLENBQUM7QUFFRCxvQkFBWSxZQUFZLEFBQUMsRUFBQyxLQUFLLEFBQUMsQ0FBQyxTQUFTLE1BQUssQ0FBRTtBQUUvQyxlQUFLLE9BQU8sRUFBSSxPQUFLLENBQUM7QUFDdEIsZUFBSyxhQUFhLEVBQUksVUFBUyxLQUFJLENBQUU7QUFDbkMsa0JBQU0sSUFBSSxBQUFDLENBQUMsWUFBVyxFQUFJLENBQUEsS0FBSSxLQUFLLENBQUEsQ0FBSSxJQUFFLENBQUEsQ0FBSSxDQUFBLEtBQUksT0FBTyxDQUFDLENBQUM7QUFDM0Qsd0JBQVksYUFBYSxBQUFDLENBQUMsS0FBSSxLQUFLLENBQUcsQ0FBQSxLQUFJLGFBQWEsS0FBSyxDQUFHLENBQUEsS0FBSSxPQUFPLENBQUMsQ0FBQztVQUMvRSxDQUFDO0FBS0QsZUFBSyxRQUFRLEFBQUMsQ0FBQyxTQUFTLEtBQUksQ0FBRTtBQUM1QixpQkFBSyxPQUFPLEFBQUMsQ0FBQyxTQUFTLEFBQUQsQ0FBRTtBQUN0QixtQkFBTyxDQUFBLEtBQUksYUFBYSxDQUFDO1lBQzNCLENBQUcsVUFBUyxZQUFXLENBQUcsQ0FBQSxRQUFPLENBQUU7QUFDakMsaUJBQUksWUFBVyxJQUFNLFNBQU8sQ0FBRTtBQUM1QixzQkFBTSxJQUFJLEFBQUMsQ0FBQyxVQUFTLEVBQUksQ0FBQSxLQUFJLEtBQUssQ0FBQSxDQUFJLElBQUUsQ0FBQSxDQUFJLENBQUEsWUFBVyxLQUFLLENBQUEsQ0FBSSxJQUFFLENBQUEsQ0FBSSxDQUFBLEtBQUksT0FBTyxDQUFDLENBQUM7QUFDbkYsNEJBQVksYUFBYSxBQUFDLENBQUMsS0FBSSxLQUFLLENBQUcsQ0FBQSxZQUFXLEtBQUssQ0FBRyxDQUFBLEtBQUksT0FBTyxDQUFDLENBQUM7Y0FDekU7QUFBQSxZQUNGLENBQUMsQ0FBQztVQUNKLENBQUMsQ0FBQztRQUNKLENBQUMsQ0FBQztNQUNKO0FBQ0EsU0FBRyxDQUFHLFVBQVMsS0FBSSxDQUFHO0FBQ3BCLFlBQUksS0FBSyxFQUFJO0FBQ1gsWUFBRSxDQUFHLEdBQUM7QUFDTixjQUFJLENBQUcsVUFBUTtBQUFBLFFBQ2pCLENBQUM7QUFFRCxZQUFJLE9BQU8sRUFBSSxVQUFTLEdBQUUsQ0FBRTtBQUMxQixjQUFJLEtBQUssTUFBTSxFQUFJLFVBQVEsQ0FBQztBQUM1QixjQUFJLElBQUksRUFBSSxJQUFFLENBQUM7QUFDZixhQUFJLEdBQUUsQ0FBRztBQUNQLGdCQUFJLElBQUksQUFBQyxDQUFDLEdBQUUsQ0FBQyxRQUFRLEFBQUMsQ0FBQyxTQUFVLEdBQUUsQ0FBRztBQUNwQyxrQkFBSSxLQUFLLE1BQU0sRUFBSSxJQUFFLENBQUM7WUFDeEIsQ0FBQyxDQUFDO1VBQ0o7QUFBQSxRQUNGLENBQUM7TUFDSDtBQUFBLElBQ0YsQ0FBQztFQUNIO0FBQUEsQUExRUksSUFBQSxDQUFBLFVBQVMsRUE0RUUsb0JBQWtCLEFBNUVBLENBQUE7QUFBakMsU0FBQSxhQUF3QjtBQUFFLHVCQUF3QjtJQUFFLEVBQTdCO0FBRWpCLENBRndELENBQUM7QUFBL0QsY0FBYyxRQUFRLFFBQVEsRUFBSSxLQUFHLENBQUE7QUFBckMsS0FBSyxlQUFlLEFBQUMsNkJBQW9CLEdBQUMsQ0FBMUMsVUFBUyxBQUFEOztBQUFSLEFBQUksSUFBQSxDQUFBLFlBQVcsOEJBQW9CLENBQUM7SUNBN0IsbUJBQWlCLEVBQXhCLENBQUEsTUFBSyxJQUFJLEFBQUMsb0NBQWtCO0lBQ3JCLHFCQUFtQixFQUQxQixDQUFBLE1BQUssSUFBSSxBQUFDLHdDQUFrQjtJQUVyQixvQkFBa0IsRUFGekIsQ0FBQSxNQUFLLElBQUksQUFBQyxzQ0FBa0I7QUFBNUIsQUFBSSxJQUFBLENBQUEsVUFBUyxFQUlFLENBQUEsT0FBTSxPQUFPLEFBQUMsQ0FBQyxVQUFTLENBQUcsRUFBQyxvQkFBbUIsQ0FBRyxrQkFBZ0IsQ0FBRyxZQUFVLENBQUMsQ0FBQyxRQUN2RixBQUFDLENBQUMsZUFBYyxDQUFHLHFCQUFtQixDQUFDLFFBQ3ZDLEFBQUMsQ0FBQyxtQkFBa0IsQ0FBRyxVQUFTLEtBQUksQ0FBRztBQUM1QyxTQUFPLENBQUEsS0FBSSxtQkFBbUIsQUFBQyxDQUFDLGVBQWMsQ0FBQyxDQUFDO0VBQ2xELENBQUMsVUFDUSxBQUFDLENBQUMsV0FBVSxDQUFHLG1CQUFpQixDQUFDLFVBQ2pDLEFBQUMsQ0FBQyxZQUFXLENBQUcsb0JBQWtCLENBQUMsQUFWYixDQUFBO0FBQWpDLFNBQUEsYUFBd0I7QUFBRSx1QkFBd0I7SUFBRSxFQUE3QjtBQUVqQixDQUZ3RCxDQUFDO0FBQS9ELEtBQUssSUFBSSxBQUFDLENBQUMsNkJBQW1CLEdBQUMsQ0FBQyxDQUFBIiwiZmlsZSI6Ii9Vc2Vycy90c2h1c2hhbi9kZXYvTGVvbmFyZG8vZGlzdC9tb2R1bGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBhY3RpdmF0b3JEaXJlY3RpdmUoJGNvbXBpbGUpIHtcbiAgcmV0dXJuIHtcbiAgICByZXN0cmljdDogJ0EnLFxuICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtKSB7XG4gICAgICB2YXIgZWwgPSBhbmd1bGFyLmVsZW1lbnQoJzxkaXYgbmctY2xpY2s9XCJhY3RpdmF0ZSgpXCIgY2xhc3M9XCJsZW9uYXJkby1hY3RpdmF0b3JcIj48L2Rpdj4nKTtcblxuICAgICAgdmFyIHdpbiA9IGFuZ3VsYXIuZWxlbWVudChbXG4gICAgICAnPGRpdiBjbGFzcz1cImxlb25hcmRvLXdpbmRvd1wiPicsXG4gICAgICAgICc8ZGl2IGNsYXNzPVwibGVvbmFyZG8taGVhZGVyXCI+TGVvbmFyZG8gQ29uZmlndXJhdGlvbjwvZGl2PicsXG4gICAgICAgICAgJzx3aW5kb3ctYm9keT48L3dpbmRvdy1ib2R5PicsXG4gICAgICAgICc8L2Rpdj4nLFxuICAgICAgJzwvZGl2PidcbiAgICAgIF0uam9pbignJykpO1xuXG4gICAgICAkY29tcGlsZShlbCkoc2NvcGUpO1xuICAgICAgJGNvbXBpbGUod2luKShzY29wZSk7XG5cbiAgICAgIGVsZW0uYXBwZW5kKGVsKTtcbiAgICAgIGVsZW0uYXBwZW5kKHdpbik7XG5cbiAgICAgIHdpblswXS5hZGRFdmVudExpc3RlbmVyKCAnd2Via2l0VHJhbnNpdGlvbkVuZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoIWRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmNvbnRhaW5zKCdwdWxsLXRvcCcpKXtcbiAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoXCJwdWxsLXRvcC1jbG9zZWRcIik7XG4gICAgICAgIH1cbiAgICAgIH0sIGZhbHNlICk7XG5cbiAgICAgIHNjb3BlLmFjdGl2YXRlID0gZnVuY3Rpb24oKXtcbiAgICAgICAgaWYgKCFkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5jb250YWlucygncHVsbC10b3AnKSkge1xuICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgncHVsbC10b3AnKTtcbiAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ3B1bGwtdG9wLWNsb3NlZCcpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgncHVsbC10b3AnKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IGFjdGl2YXRvckRpcmVjdGl2ZSIsImZ1bmN0aW9uIGNvbmZpZ3VyYXRpb25TZXJ2aWNlKCRxLCBhY3RpdmVTdGF0ZXNTdG9yZSwgJGh0dHBCYWNrZW5kKSB7XG4gIHZhciBzdGF0ZXMgPSBbXTtcbiAgdmFyIHN0YXRlUmVxID0ge307XG5cbiAgdmFyIHVwc2VydE9wdGlvbiA9IGZ1bmN0aW9uKHN0YXRlLCBuYW1lLCBhY3RpdmUpIHtcbiAgICB2YXIgc3RhdGVzID0gZ2V0U3RhdGVzRnJvbVN0b3JlKCk7XG4gICAgc3RhdGVzW3N0YXRlXSA9IHtcbiAgICAgIG5hbWU6IG5hbWUsXG4gICAgICBhY3RpdmU6IGFjdGl2ZVxuICAgIH07XG5cbiAgICBhY3RpdmVTdGF0ZXNTdG9yZS5zZXQoJ3N0YXRlcycsIHN0YXRlcyk7XG5cbiAgICByZXR1cm4gc3luYygpO1xuICB9O1xuXG4gIGZ1bmN0aW9uIGdldFN0YXRlc0Zyb21TdG9yZSgpe1xuICAgIHJldHVybiBhY3RpdmVTdGF0ZXNTdG9yZS5nZXQoJ3N0YXRlcycpIHx8IHt9O1xuICB9XG5cbiAgZnVuY3Rpb24gZmV0Y2hTdGF0ZXMoKXtcbiAgICB2YXIgYWN0aXZlU3RhdGVzID0gZ2V0U3RhdGVzRnJvbVN0b3JlKCk7XG4gICAgdmFyIF9zdGF0ZXMgPSBzdGF0ZXMubWFwKHN0YXRlID0+IGFuZ3VsYXIuY29weShzdGF0ZSkpO1xuXG4gICBfc3RhdGVzLmZvckVhY2goZnVuY3Rpb24oc3RhdGUpIHtcbiAgICAgIGxldCBvcHRpb24gPSBhY3RpdmVTdGF0ZXNbc3RhdGUubmFtZV07XG4gICAgICBzdGF0ZS5hY3RpdmUgPSAhIW9wdGlvbiAmJiBvcHRpb24uYWN0aXZlO1xuICAgICAgc3RhdGUuYWN0aXZlT3B0aW9uID0gISFvcHRpb24gPyBzdGF0ZS5vcHRpb25zLmZpbmQoX29wdGlvbiA9PiBfb3B0aW9uLm5hbWUgPT09IG9wdGlvbi5uYW1lKSA6IHN0YXRlLm9wdGlvbnNbMF07XG4gICAgfSk7XG5cbiAgICByZXR1cm4gJHEud2hlbihfc3RhdGVzKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRlYWN0aXZhdGVBbGwoKSB7XG4gICAgdmFyIHN0b3JlZFN0YXRlcyA9IGdldFN0YXRlc0Zyb21TdG9yZSgpO1xuICAgIE9iamVjdC5rZXlzKHN0b3JlZFN0YXRlcykuZm9yRWFjaChmdW5jdGlvbihzdGF0ZUtleSkge1xuICAgICAgc3RvcmVkU3RhdGVzW3N0YXRlS2V5XS5hY3RpdmUgPSBmYWxzZTtcbiAgICB9KTtcbiAgICBhY3RpdmVTdGF0ZXNTdG9yZS5zZXQoJ3N0YXRlcycsIHN0b3JlZFN0YXRlcyk7XG4gIH1cblxuICBmdW5jdGlvbiBmaW5kU3RhdGVPcHRpb24obmFtZSl7XG4gICAgcmV0dXJuIGZldGNoU3RhdGVzKCkudGhlbihmdW5jdGlvbihzdGF0ZXMpe1xuICAgICAgcmV0dXJuIHN0YXRlcy5maW5kKHN0YXRlID0+IHN0YXRlLm5hbWUgPT09IG5hbWUpLmFjdGl2ZU9wdGlvbjtcbiAgICB9KTtcblxuICB9XG5cbiAgZnVuY3Rpb24gc3luYygpe1xuICAgIHJldHVybiBmZXRjaFN0YXRlcygpLnRoZW4oZnVuY3Rpb24oc3RhdGVzKSB7XG4gICAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xuICAgICAgdmFyIHByb21pc2UgPSBkZWZlci5wcm9taXNlO1xuICAgICAgZGVmZXIucmVzb2x2ZSgpO1xuICAgICAgc3RhdGVzLmZvckVhY2goZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgIHByb21pc2UgPSBwcm9taXNlLnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgICAgICByZXR1cm4gZmluZFN0YXRlT3B0aW9uKHN0YXRlLm5hbWUpLnRoZW4oZnVuY3Rpb24ob3B0aW9uKXtcbiAgICAgICAgICAgIGlmIChzdGF0ZS5hY3RpdmUpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHN0YXRlUmVxW3N0YXRlLm5hbWVdLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICAvLyR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIC8vICBkZWZlcnJlZC5yZXNvbHZlKFtvcHRpb24uc3RhdHVzLCBvcHRpb24uZGF0YV0pO1xuICAgICAgICAgICAgICAgIC8vfSwgb3B0aW9uLmRlbGF5KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gW29wdGlvbi5zdGF0dXMsIG9wdGlvbi5kYXRhXTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgc3RhdGVSZXFbc3RhdGUubmFtZV0ucGFzc1Rocm91Z2goKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgfSk7XG4gIH1cblxuICB2YXIgaW5pdGlhbGl6ZWQgPSBmZXRjaFN0YXRlcygpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgKHN0YXRlcyB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgIHN0YXRlUmVxW3N0YXRlLm5hbWVdID0gJGh0dHBCYWNrZW5kLndoZW4oc3RhdGUudmVyYiB8fCAnR0VUJywgbmV3IFJlZ0V4cChzdGF0ZS51cmwpKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICAvL2NvbmZpZ3VyZWQgc3RhdGVzIHRvZG8gZG9jXG4gICAgc3RhdGVzOiBzdGF0ZXMsXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiBpbml0aWFsaXplZC50aGVuKHN5bmMpO1xuICAgIH0sXG4gICAgLy90b2RvIGRvY1xuICAgIGFjdGl2ZV9zdGF0ZXNfb3B0aW9uOiBbXSxcbiAgICAvL3RvZG8gZG9jXG4gICAgdXBzZXJ0T3B0aW9uOiB1cHNlcnRPcHRpb24sXG4gICAgLy90b2RvIGRvY1xuICAgIGZldGNoU3RhdGVzOiBmZXRjaFN0YXRlcyxcbiAgICBnZXRTdGF0ZTogZnVuY3Rpb24obmFtZSl7XG4gICAgICByZXR1cm4gZmV0Y2hTdGF0ZXMoKS50aGVuKGZ1bmN0aW9uKHN0YXRlcyl7XG4gICAgICAgIHZhciBzdGF0ZSA9IHN0YXRlcy5maW5kKHN0YXRlID0+IHN0YXRlLm5hbWUgPT09IG5hbWUpO1xuICAgICAgICByZXR1cm4gKHN0YXRlICYmIHN0YXRlLmFjdGl2ZSAmJiBmaW5kU3RhdGVPcHRpb24obmFtZSkpIHx8ICRxLndoZW4obnVsbCk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIC8vaW5zZXJ0IG9yIHJlcGxhY2UgYW4gb3B0aW9uIGJ5IGluc2VydCBvciB1cGRhdGVpbmcgYSBzdGF0ZS5cbiAgICB1cHNlcnQ6IGZ1bmN0aW9uKHsgdmVyYiwgc3RhdGUsIG5hbWUsIHVybCwgc3RhdHVzID0gMjAwLCBkYXRhID0ge30sIGRlbGF5ID0gMH0pe1xuICAgICAgdmFyIGRlZmF1bHRTdGF0ZSA9IHt9O1xuXG4gICAgICB2YXIgZGVmYXVsdE9wdGlvbiA9IHt9O1xuXG4gICAgICBpZiAoIXN0YXRlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiY2Fubm90IHVwc2VydCAtIHN0YXRlIGlzIG1hbmRhdG9yeVwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB2YXIgc3RhdGVJdGVtID0gc3RhdGVzLmZpbmQoX3N0YXRlID0+IF9zdGF0ZS5uYW1lID09PSBzdGF0ZSkgfHwgZGVmYXVsdFN0YXRlO1xuXG5cbiAgICAgIGNvbnNvbGUubG9nKFwiXCIpO1xuXG4gICAgICBhbmd1bGFyLmV4dGVuZChzdGF0ZUl0ZW0sIHtcbiAgICAgICAgbmFtZTogc3RhdGUsXG4gICAgICAgIHVybDogdXJsIHx8IHN0YXRlSXRlbS51cmwsXG4gICAgICAgIHZlcmI6IHZlcmIgfHwgc3RhdGVJdGVtLnZlcmIsXG4gICAgICAgIG9wdGlvbnM6IHN0YXRlSXRlbS5vcHRpb25zIHx8IFtdXG4gICAgICB9KTtcblxuXG4gICAgICBpZiAoc3RhdGVJdGVtID09PSBkZWZhdWx0U3RhdGUpIHtcbiAgICAgICAgc3RhdGVzLnB1c2goc3RhdGVJdGVtKTtcbiAgICAgIH1cblxuICAgICAgdmFyIG9wdGlvbiA9IHN0YXRlSXRlbS5vcHRpb25zLmZpbmQoX29wdGlvbiA9PiBfb3B0aW9uLm5hbWUgPT09IG5hbWUpIHx8IGRlZmF1bHRPcHRpb247XG5cbiAgICAgIGFuZ3VsYXIuZXh0ZW5kKG9wdGlvbiwge1xuICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICBzdGF0dXM6IHN0YXR1cyxcbiAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgZGVsYXk6IGRlbGF5XG4gICAgICB9KTtcblxuICAgICAgaWYgKG9wdGlvbiA9PT0gZGVmYXVsdE9wdGlvbikge1xuICAgICAgICBzdGF0ZUl0ZW0ub3B0aW9ucy5wdXNoKG9wdGlvbik7XG4gICAgICB9XG4gICAgfSxcbiAgICAvL3RvZG8gZG9jXG4gICAgdXBzZXJ0TWFueTogZnVuY3Rpb24oaXRlbXMpe1xuICAgICAgaXRlbXMuZm9yRWFjaChpdGVtID0+IHRoaXMudXBzZXJ0KGl0ZW0pKTtcbiAgICB9LFxuICAgIGRlYWN0aXZhdGVBbGw6IGRlYWN0aXZhdGVBbGxcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY29uZmlndXJhdGlvblNlcnZpY2U7IiwiLy8gVGhpcyBJcyBBIEhlYWRlclxuLy8gLS0tLS0tLS0tLS0tLS0tLVxuXG5cbi8vIFRoaXMgaXMgYSBub3JtYWwgY29tbWVudCwgdGhhdCB3aWxsIGJlY29tZSBwYXJ0IG9mIHRoZVxuLy8gYW5ub3RhdGlvbnMgYWZ0ZXIgcnVubmluZyB0aHJvdWdoIHRoZSBEb2NjbyB0b29sLiBVc2UgdGhpc1xuLy8gc3BhY2UgdG8gZGVzY3JpYmUgdGhlIGZ1bmN0aW9uIG9yIG90aGVyIGNvZGUganVzdCBiZWxvd1xuLy8gdGhpcyBjb21tZW50LiBGb3IgZXhhbXBsZTpcbi8vXG4vLyBUaGUgYERvU29tZXRoaW5nYCBtZXRob2QgZG9lcyBzb21ldGhpbmchIEl0IGRvZXNuJ3QgdGFrZSBhbnlcbi8vIHBhcmFtZXRlcnMuLi4gaXQganVzdCBkb2VzIHNvbWV0aGluZy5cbmZ1bmN0aW9uIHdpbmRvd0JvZHlEaXJlY3RpdmUoJGh0dHAsIGNvbmZpZ3VyYXRpb24pIHtcbiAgcmV0dXJuIHtcbiAgICByZXN0cmljdDogJ0UnLFxuICAgIHRlbXBsYXRlVXJsOiAnd2luZG93LWJvZHkuaHRtbCcsXG4gICAgc2NvcGU6IHRydWUsXG4gICAgcmVwbGFjZTogdHJ1ZSxcbiAgICBjb250cm9sbGVyOiBmdW5jdGlvbigkc2NvcGUpe1xuICAgICAgJHNjb3BlLnNlbGVjdGVkSXRlbSA9ICdhY3RpdmF0ZSc7XG4gICAgICAkc2NvcGUuTm90aGFzVXJsID0gZnVuY3Rpb24ob3B0aW9uKXtcbiAgICAgICAgcmV0dXJuICFvcHRpb24udXJsO1xuICAgICAgfTtcbiAgICAgICRzY29wZS5oYXNVcmwgPSBmdW5jdGlvbihvcHRpb24pe1xuICAgICAgICByZXR1cm4gISFvcHRpb24udXJsO1xuICAgICAgfTtcblxuICAgICAgJHNjb3BlLmRlYWN0aXZhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgJHNjb3BlLnN0YXRlcy5mb3JFYWNoKGZ1bmN0aW9uKHN0YXRlKXtcbiAgICAgICAgICAgIHN0YXRlLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgLy8kc2NvcGUuY2hhbmdlQWN0aXZlKHN0YXRlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbmZpZ3VyYXRpb24uZGVhY3RpdmF0ZUFsbCgpO1xuICAgICAgfTtcblxuICAgICAgY29uZmlndXJhdGlvbi5mZXRjaFN0YXRlcygpLnRoZW4oZnVuY3Rpb24oc3RhdGVzKXtcblxuICAgICAgICAkc2NvcGUuc3RhdGVzID0gc3RhdGVzO1xuICAgICAgICAkc2NvcGUuY2hhbmdlQWN0aXZlID0gZnVuY3Rpb24oc3RhdGUpe1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiYWN0aXZhdGU6IFwiICsgc3RhdGUubmFtZSArIFwiIFwiICsgc3RhdGUuYWN0aXZlKTtcbiAgICAgICAgICBjb25maWd1cmF0aW9uLnVwc2VydE9wdGlvbihzdGF0ZS5uYW1lLCBzdGF0ZS5hY3RpdmVPcHRpb24ubmFtZSwgc3RhdGUuYWN0aXZlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvL21vdmUgdG8gb24gY2hhbmdlIG9mIHRoZSBzZWxlY3QgYm94XG4gICAgICAgIC8vXG5cbiAgICAgICAgc3RhdGVzLmZvckVhY2goZnVuY3Rpb24oc3RhdGUpe1xuICAgICAgICAgICRzY29wZS4kd2F0Y2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZS5hY3RpdmVPcHRpb247XG4gICAgICAgICAgfSwgZnVuY3Rpb24oYWN0aXZlT3B0aW9uLCBvbGRWYWx1ZSl7XG4gICAgICAgICAgICBpZiAoYWN0aXZlT3B0aW9uICE9PSBvbGRWYWx1ZSl7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic2VsZWN0OiBcIiArIHN0YXRlLm5hbWUgKyBcIiBcIiArIGFjdGl2ZU9wdGlvbi5uYW1lICsgXCIgXCIgKyBzdGF0ZS5hY3RpdmUpO1xuICAgICAgICAgICAgICBjb25maWd1cmF0aW9uLnVwc2VydE9wdGlvbihzdGF0ZS5uYW1lLCBhY3RpdmVPcHRpb24ubmFtZSwgc3RhdGUuYWN0aXZlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlKSB7XG4gICAgICBzY29wZS50ZXN0ID0ge1xuICAgICAgICB1cmw6ICcnLFxuICAgICAgICB2YWx1ZTogdW5kZWZpbmVkXG4gICAgICB9O1xuXG4gICAgICBzY29wZS5zdWJtaXQgPSBmdW5jdGlvbih1cmwpe1xuICAgICAgICBzY29wZS50ZXN0LnZhbHVlID0gdW5kZWZpbmVkO1xuICAgICAgICBzY29wZS51cmwgPSB1cmw7XG4gICAgICAgIGlmICh1cmwpIHtcbiAgICAgICAgICAkaHR0cC5nZXQodXJsKS5zdWNjZXNzKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIHNjb3BlLnRlc3QudmFsdWUgPSByZXM7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCB3aW5kb3dCb2R5RGlyZWN0aXZlIiwiaW1wb3J0IGFjdGl2YXRvckRpcmVjdGl2ZSBmcm9tICcuL2FjdGl2YXRvci5kcnYuanMnO1xuaW1wb3J0IGNvbmZpZ3VyYXRpb25TZXJ2aWNlIGZyb20gJy4vY29uZmlndXJhdGlvbi5zcnYuanMnO1xuaW1wb3J0IHdpbmRvd0JvZHlEaXJlY3RpdmUgZnJvbSAnLi93aW5kb3ctYm9keS5kcnYuanMnO1xuXG5leHBvcnQgZGVmYXVsdCBhbmd1bGFyLm1vZHVsZSgnbGVvbmFyZG8nLCBbJ2xlb25hcmRvLnRlbXBsYXRlcycsICdhbmd1bGFyLXN0b3JhZ2UnLCAnbmdNb2NrRTJFJ10pXG4gIC5mYWN0b3J5KCdjb25maWd1cmF0aW9uJywgY29uZmlndXJhdGlvblNlcnZpY2UpXG4gIC5mYWN0b3J5KCdhY3RpdmVTdGF0ZXNTdG9yZScsIGZ1bmN0aW9uKHN0b3JlKSB7XG4gICAgcmV0dXJuIHN0b3JlLmdldE5hbWVzcGFjZWRTdG9yZSgnYWN0aXZlX3N0YXRlcycpO1xuICB9KVxuICAuZGlyZWN0aXZlKCdhY3RpdmF0b3InLCBhY3RpdmF0b3JEaXJlY3RpdmUpXG4gIC5kaXJlY3RpdmUoJ3dpbmRvd0JvZHknLCB3aW5kb3dCb2R5RGlyZWN0aXZlKTtcblxuIl19
